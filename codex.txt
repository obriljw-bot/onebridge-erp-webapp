ApiService.js
+50
-10

@@ -460,64 +460,88 @@ function deleteOrder(orderId) {
      sheet.deleteRow(rowNum);
    });
    
    return {
      success: true,
      deleted: rowsToDelete.length
    };
    
  } catch (err) {
    Logger.log('[deleteOrder Error] ' + err.message);
    return {
      success: false,
      error: err.message
    };
  }
}

/**
 * ============================================================
 * ê±°ë˜ì²˜ ëª©ë¡ (ë°œì£¼ì²˜ + ë§¤ì…ì²˜)
 * ============================================================
 */
function getCustomers() {
  try {
    var data = getSuppliers();
    
    var customers = data.rows.map(function(row) {
      var obj = {};
      data.header.forEach(function(h, idx) {
        obj[h] = row[idx];
      });
      return obj;
    var header = data.header || [];
    var rows = data.rows || [];

    var nameIdx = header.indexOf('ê±°ë˜ì²˜ëª…');
    var mainTypeIdx = header.indexOf('ì£¼ê±°ë˜ì²˜');

    if (nameIdx < 0) {
      return {
        success: false,
        error: 'ê±°ë˜ì²˜ëª… ì»¬ëŸ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
        data: []
      };
    }

    var seen = {};
    var customers = [];

    rows.forEach(function(row) {
      var name = String(row[nameIdx] || '').trim();
      var mainType = mainTypeIdx >= 0 ? String(row[mainTypeIdx] || '').trim() : '';

      // 'ë°œì£¼ì²˜'ê°€ í¬í•¨ëœ ê±°ë˜ì²˜ë§Œ ì„ íƒ(ì»¬ëŸ¼ì´ ì—†ìœ¼ë©´ ì „ì²´ í—ˆìš©)
      var isOrderPartner = mainTypeIdx < 0 || mainType.indexOf('ë°œì£¼ì²˜') >= 0;

      if (name && isOrderPartner && !seen[name]) {
        customers.push(name);
        seen[name] = true;
      }
    });
    

    return {
      success: true,
      customers: customers
      data: customers,
      customers: customers,
      header: header,
      rows: rows
    };
    

  } catch (err) {
    Logger.log('[getCustomers Error] ' + err.message);
    return {
      success: false,
      error: err.message
    };
  }
}

/**
 * ============================================================
 * í’ˆëª© ëª©ë¡
 * ============================================================
 */
function getProductsApi() {
  try {
    var data = getProducts();
    
    var products = data.rows.map(function(row) {
      var obj = {};
      data.header.forEach(function(h, idx) {
        obj[h] = row[idx];
      });
      return obj;
    });
@@ -734,88 +758,104 @@ function savePurchaseSettlementApi(params) {

/**
 * ë§¤ì¶œ ë§ˆê° ì €ì¥
 */
function saveSalesSettlementApi(params) {
  var result = saveSalesSettlement(params);
  return safeReturn(result);
}

/**
 * ë§¤ì… ë§ˆê° ëª©ë¡ ì¡°íšŒ
 */
function getPurchaseSettlementsApi(params) {
  var result = getPurchaseSettlements(params);
  return safeReturn(result);
}

/**
 * ë§¤ì¶œ ë§ˆê° ëª©ë¡ ì¡°íšŒ
 */
function getSalesSettlementsApi(params) {
  var result = getSalesSettlements(params);
  return safeReturn(result);
}

/**
 * ë§ˆê° ìƒì„¸ ì¡°íšŒ
 */
function getSettlementDetailApi(params) {
  var result = getSettlementDetail(params);
  return safeReturn(result);
}

/**
 * ============================================================
 * ì²­êµ¬ì„œ ê´€ë¦¬ API (InvoiceService)
 * ============================================================
 */

/**
 * ì²­êµ¬ì„œìš© ë°ì´í„° ì§‘ê³„
 */
function aggregateInvoiceDataApi(params) {
  var result = aggregateInvoiceData(params);
  return safeReturn(result);
}

/**
 * Settlement ê¸°ë°˜ ì²­êµ¬ì„œ ìƒì„±
 */
function createInvoiceFromSettlementApi(params) {
  var result = createInvoiceFromSettlement(params);
  return safeReturn(result);
}

/**
 * ì²­êµ¬ì„œ ëª©ë¡ ì¡°íšŒ
 */
function getInvoicesApi(params) {
  var result = getInvoices(params);
  return safeReturn(result);
}

/**
 * ì²­êµ¬ì„œ ìƒíƒœ ì—…ë°ì´íŠ¸
 */
function updateInvoiceStatusApi(params) {
  var result = updateInvoiceStatus(params);
  return safeReturn(result);
}

/**
 * ì²­êµ¬ì„œ ì¬ì¶œë ¥
 */
function reprintInvoiceApi(params) {
  var result = reprintInvoice(params);
  return safeReturn(result);
}

/**
 * ============================================================
 * í•˜ìœ„ í˜¸í™˜ì„±ì„ ìœ„í•œ Deprecated API (ê³§ ì œê±° ì˜ˆì •)
 * ============================================================
 */

/**
 * @deprecated aggregateInvoiceDataApi ì‚¬ìš© ê¶Œì¥
 */
function aggregateBillingDataApi(params) {
  return aggregateInvoiceDataApi(params);
}

/**
 * @deprecated createInvoiceFromSettlementApi ì‚¬ìš© ê¶Œì¥
 */
function createBillingApi(params) {
  return createInvoiceFromSettlementApi(params);
}

/**
 * @deprecated getInvoicesApi ì‚¬ìš© ê¶Œì¥
 */
function getBillingsApi(params) {
  return getInvoicesApi(params);
CommonScripts.html
+1108
-8

@@ -16,59 +16,68 @@

  // ===== ê³µí†µ í˜ì´ì§€ ì´ˆê¸°í™” ë¡œì§ =====
  OB.initCurrentPage = function(page) {
    console.log('ğŸ”§ initCurrentPage í˜¸ì¶œ:', page);
    
    if (OB.state.initializedPages[page]) {
      console.log('â­ï¸  ì´ë¯¸ ì´ˆê¸°í™”ë¨:', page);
      return;
    }

    var initFuncName = null;

    switch(page) {
      case 'orderFile':
        initFuncName = 'initOrderFilePage';
        break;
      case 'dashboard':
        initFuncName = 'initDashboardPage';
        break;
      case 'orderList':
        initFuncName = 'initOrderListPage';
        break;
      case 'invoiceOutput':
        initFuncName = 'initInvoiceOutputPage';
        break;
      case 'transactionLedger':
        initFuncName = 'initTransactionLedgerPage';
        break;
      case 'purchaseSettlement':
        initFuncName = 'initPurchaseSettlementPage';
        break;
      case 'salesSettlement':
        initFuncName = 'initSalesSettlementPage';
        break;
      case 'monthlyClosing':
        initFuncName = 'initMonthlyClosingPage';
        break;
      case 'billingManagement':
        initFuncName = 'initBillingManagementPage';
        break;
      case 'invoiceManagement':
        initFuncName = 'initInvoiceManagementPage';
        break;
      case 'settings':
        initFuncName = 'initSettingsPage';
        break;
    }

    if (initFuncName && typeof OB[initFuncName] === 'function') {
      console.log('âœ… ì´ˆê¸°í™” í•¨ìˆ˜ ì‹¤í–‰:', initFuncName);
      
      try {
        OB[initFuncName]();
        OB.state.initializedPages[page] = true;
        console.log('âœ… ì´ˆê¸°í™” ì™„ë£Œ:', page);
      } catch (err) {
        console.error('âŒ ì´ˆê¸°í™” ì‹¤íŒ¨:', page, err);
      }
    } else {
      console.warn('âš ï¸  ì´ˆê¸°í™” í•¨ìˆ˜ ì—†ìŒ:', page, initFuncName);
    }
  };

  // ===== ë¡œë”© ì˜¤ë²„ë ˆì´ =====
  OB.showLoading = function (message) {
    var overlay = document.getElementById('ob-loading-overlay');
    var textEl = document.getElementById('ob-loading-text');
    if (!overlay || !textEl) return;
@@ -170,50 +179,425 @@
    console.log('ğŸš€ DOMContentLoaded - ì´ˆê¸° í˜ì´ì§€:', OB.state.currentPage);

    setupNavLinks();
    OB.highlightActiveNav(OB.state.currentPage);
    OB.initCurrentPage(OB.state.currentPage);
  });

  // ===== ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ =====
  OB.formatNumber = function(num) {
    if (num === null || num === undefined || num === '') return '0';
    return Number(num).toLocaleString('ko-KR');
  };

  OB.formatDate = function(date) {
    if (!date) return '';
    if (typeof date === 'string') return date;
    
    var d = new Date(date);
    var year = d.getFullYear();
    var month = String(d.getMonth() + 1).padStart(2, '0');
    var day = String(d.getDate()).padStart(2, '0');
    
    return year + '-' + month + '-' + day;
  };

  // ===========================================================
  // âœ… OrderFile í˜ì´ì§€ ì´ˆê¸°í™” í•¨ìˆ˜
  // ===========================================================
  OB.initOrderFilePage = function() {
    var wrap = document.getElementById('ob-orderfile-wrap');
    if (!wrap) {
      console.warn('OrderFile wrapper not found');
      return;
    }

    if (wrap.dataset.bound === '1') {
      console.log('OrderFile already initialized');
      return;
    }
    wrap.dataset.bound = '1';

    console.log('âœ… OrderFile Page ì´ˆê¸°í™” ì™„ë£Œ');

    var parsedItems = [];
    var currentFilter = 'all'; // 'all' or 'unmatched'

    var customerSelect = document.getElementById('ob-customer-select');
    var fileInput = document.getElementById('ob-orderfile-input');
    var btnParse = document.getElementById('ob-btn-parse');
    var btnSave = document.getElementById('ob-btn-save');
    var tableBody = document.querySelector('#ob-orderfile-table tbody');

    var summaryCards = document.getElementById('ob-summary-cards');
    var summaryTotal = document.getElementById('summary-total');
    var summaryMatched = document.getElementById('summary-matched');
    var summaryUnmatched = document.getElementById('summary-unmatched');
    var summaryAmount = document.getElementById('summary-amount');
    var summaryMatchCard = document.getElementById('summary-match-card');

    var filterControls = document.getElementById('ob-filter-controls');
    var btnFilterUnmatched = document.getElementById('ob-btn-filter-unmatched');
    var btnFilterAll = document.getElementById('ob-btn-filter-all');

    var duplicateModal = document.getElementById('ob-duplicate-modal');
    var duplicateOrderList = document.getElementById('duplicate-order-list');
    var btnDuplicateCancel = document.getElementById('ob-btn-duplicate-cancel');
    var btnDuplicateContinue = document.getElementById('ob-btn-duplicate-continue');

    loadCustomers();

    function loadCustomers() {
      console.log('ğŸ“„ ë°œì£¼ì²˜ ëª©ë¡ ë¡œë“œ ì¤‘...');

      google.script.run
        .withSuccessHandler(function(result) {
          console.log('âœ… ë°œì£¼ì²˜ ì‘ë‹µ:', result);

          var customerList = [];
          if (result && result.success) {
            if (Array.isArray(result.data)) {
              customerList = result.data;
            } else if (Array.isArray(result.customers)) {
              customerList = result.customers;
            }
          }

          if (!customerList.length) {
            console.warn('âš ï¸ ë°œì£¼ì²˜ ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
            return;
          }

          customerList.forEach(function(customerName) {
            var option = document.createElement('option');
            option.value = customerName;
            option.textContent = customerName;
            customerSelect.appendChild(option);
          });

          console.log('âœ… ë°œì£¼ì²˜ ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸° ì™„ë£Œ');
        })
        .withFailureHandler(function(error) {
          console.error('âŒ ë°œì£¼ì²˜ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
          alert('ë°œì£¼ì²˜ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message);
        })
        .getCustomers();
    }

    if (btnParse) {
      btnParse.addEventListener('click', function() {
        var file = fileInput.files[0];
        var selectedCustomer = customerSelect.value;

        if (!selectedCustomer) {
          alert('ë°œì£¼ì²˜ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.');
          return;
        }

        if (!file) {
          alert('íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.');
          return;
        }

        console.log('íŒŒì‹± ì‹œì‘:', file.name, 'ë°œì£¼ì²˜:', selectedCustomer);
        OB.showLoading('íŒŒì¼ì„ ì½ëŠ” ì¤‘...');

        var reader = new FileReader();

        reader.onload = function(e) {
          try {
            var data = new Uint8Array(e.target.result);
            var workbook = XLSX.read(data, { type: 'array' });

            var firstSheetName = workbook.SheetNames[0];
            var worksheet = workbook.Sheets[firstSheetName];

            var rows = XLSX.utils.sheet_to_json(worksheet, {
              header: 1,
              defval: '',
              blankrows: false
            });

            console.log('ì—‘ì…€ ì½ê¸° ì™„ë£Œ. í–‰ ìˆ˜:', rows.length);

            if (rows.length === 0) {
              OB.hideLoading();
              alert('íŒŒì¼ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
              return;
            }

            OB.showLoading('ì„œë²„ì—ì„œ ë§¤ì¹­ ì¤‘...');

            google.script.run
              .withSuccessHandler(function(result) {
                OB.hideLoading();
                console.log('íŒŒì‹± ê²°ê³¼:', result);

                if (result && result.items) {
                  parsedItems = result.items.map(function(item) {
                    item.customer = selectedCustomer;
                    return item;
                  });
                  displayParseResult(result);
                  btnSave.disabled = false;
                } else {
                  alert('íŒŒì‹± ê²°ê³¼ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }
              })
              .withFailureHandler(function(error) {
                OB.hideLoading();
                console.error('íŒŒì‹± ì‹¤íŒ¨:', error);
                alert('íŒŒì‹± ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
              })
              .processParsedOrderRows(rows);

          } catch (err) {
            OB.hideLoading();
            console.error('íŒŒì¼ ì½ê¸° ì˜¤ë¥˜:', err);
            alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
          }
        };

        reader.onerror = function(err) {
          OB.hideLoading();
          console.error('íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨:', err);
          alert('íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        };

        reader.readAsArrayBuffer(file);
      });
    }

    if (btnSave) {
      btnSave.addEventListener('click', function() {
        if (!parsedItems || parsedItems.length === 0) {
          alert('ì €ì¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € íŒŒì¼ì„ íŒŒì‹±í•´ì£¼ì„¸ìš”.');
          return;
        }

        var unmatched = parsedItems.filter(function(item) { return !item.productCode; });

        if (unmatched.length > 0) {
          var confirmMessage = 'ë§¤ì¹­ë˜ì§€ ì•Šì€ í’ˆëª©ì´ ' + unmatched.length + 'ê±´ ìˆìŠµë‹ˆë‹¤.\n' +
                               'ì´ëŒ€ë¡œ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?';
          if (!confirm(confirmMessage)) {
            return;
          }
        }

        checkDuplicateOrders(parsedItems, function(canProceed, duplicates) {
          if (!canProceed) {
            duplicateModal.style.display = 'flex';
            renderDuplicates(duplicates);
            return;
          }

          saveOrders(parsedItems);
        });
      });
    }

    function renderDuplicates(duplicates) {
      duplicateOrderList.innerHTML = '';

      duplicates.forEach(function(dup) {
        var li = document.createElement('div');
        li.className = 'ob-modal-list-item';
        li.innerHTML = '<div><div class="title">' + dup.productName + '</div>' +
                       '<div class="sub">ë°œì£¼ìˆ˜ëŸ‰: ' + dup.orderQty + ', ë°œì£¼ê¸ˆì•¡: ' + OB.formatNumber(dup.orderAmount) + '</div></div>' +
                       '<div class="status">' + dup.status + '</div>';
        duplicateOrderList.appendChild(li);
      });
    }

    if (btnDuplicateCancel) {
      btnDuplicateCancel.addEventListener('click', function() {
        duplicateModal.style.display = 'none';
      });
    }

    if (btnDuplicateContinue) {
      btnDuplicateContinue.addEventListener('click', function() {
        duplicateModal.style.display = 'none';
        saveOrders(parsedItems);
      });
    }

    function checkDuplicateOrders(items, callback) {
      var today = new Date();
      var yyyy = today.getFullYear();
      var mm = ('0' + (today.getMonth() + 1)).slice(-2);
      var dd = ('0' + today.getDate()).slice(-2);
      var todayStr = yyyy + '-' + mm + '-' + dd;

      OB.showLoading('ì˜¤ëŠ˜ ë°œì£¼ ë‚´ì—­ í™•ì¸ ì¤‘...');

      google.script.run
        .withSuccessHandler(function(result) {
          OB.hideLoading();
          console.log('ì¤‘ë³µ ì²´í¬ ê²°ê³¼:', result);

          if (!result || !result.orders) {
            callback(true, []);
            return;
          }

          var duplicates = result.orders.filter(function(order) {
            return order.orderDate === todayStr &&
                   order.customer === items[0].customer;
          });

          if (duplicates.length > 0) {
            callback(false, duplicates);
          } else {
            callback(true, []);
          }
        })
        .withFailureHandler(function(error) {
          OB.hideLoading();
          console.error('ì¤‘ë³µ í™•ì¸ ì‹¤íŒ¨:', error);
          alert('ì¤‘ë³µ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
          callback(true, []);
        })
        .getOrdersByDate(todayStr);
    }

    function saveOrders(items) {
      OB.showLoading('ë°œì£¼ ì €ì¥ ì¤‘...');

      google.script.run
        .withSuccessHandler(function(result) {
          OB.hideLoading();
          console.log('ë°œì£¼ ì €ì¥ ê²°ê³¼:', result);

          if (result && result.success) {
            alert('ë°œì£¼ ì €ì¥ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
            btnSave.disabled = true;
          } else {
            alert('ë°œì£¼ ì €ì¥ ì‹¤íŒ¨: ' + (result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
          }
        })
        .withFailureHandler(function(error) {
          OB.hideLoading();
          console.error('ë°œì£¼ ì €ì¥ ì‹¤íŒ¨:', error);
          alert('ë°œì£¼ ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
        })
        .saveOrders(items);
    }

    function displayParseResult(result) {
      if (!result || !result.items) {
        alert('íŒŒì‹± ê²°ê³¼ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        return;
      }

      summaryTotal.textContent = result.items.length;
      summaryMatched.textContent = result.matchedCount || 0;
      summaryUnmatched.textContent = result.unmatchedCount || 0;
      summaryAmount.textContent = OB.formatNumber(result.totalAmount || 0);

      if (result.items.length > 0) {
        var matchRate = ((result.matchedCount || 0) / result.items.length) * 100;
        if (matchRate >= 80) {
          summaryMatchCard.classList.add('success');
          summaryMatchCard.classList.remove('highlight');
        } else {
          summaryMatchCard.classList.add('highlight');
          summaryMatchCard.classList.remove('success');
        }
      }

      var hasUnmatched = (result.unmatchedCount || 0) > 0;
      filterControls.style.display = hasUnmatched ? 'flex' : 'none';
      btnFilterAll.style.display = 'none';
      btnFilterUnmatched.style.display = hasUnmatched ? 'inline-block' : 'none';

      renderTable(result.items);
    }

    function renderTable(items) {
      tableBody.innerHTML = '';

      items.forEach(function(item) {
        var tr = document.createElement('tr');
        if (item.productCode) {
          tr.classList.add('matched');
        } else {
          tr.classList.add('unmatched');
        }

        tr.innerHTML =
          '<td class="status-cell">' +
            (item.productCode ? '<span class="status-text status-matched">ë§¤ì¹­</span>' : '<span class="status-text status-unmatched">ë¯¸ë§¤ì¹­</span>') +
          '</td>' +
          '<td>' + (item.customer || '') + '</td>' +
          '<td>' + (item.orderDate || '') + '</td>' +
          '<td>' + (item.productName || '') + '</td>' +
          '<td>' + (item.productCode || '-') + '</td>' +
          '<td class="num">' + OB.formatNumber(item.orderQty) + '</td>' +
          '<td class="num">' + OB.formatNumber(item.orderPrice) + '</td>' +
          '<td class="num">' + OB.formatNumber(item.orderAmount) + '</td>' +
          '<td>' + (item.inboundPlace || '') + '</td>';

        tableBody.appendChild(tr);
      });
    }

    if (btnFilterUnmatched) {
      btnFilterUnmatched.addEventListener('click', function() {
        currentFilter = 'unmatched';
        applyFilter();
        btnFilterUnmatched.style.display = 'none';
        btnFilterAll.style.display = 'inline-block';
      });
    }

    if (btnFilterAll) {
      btnFilterAll.addEventListener('click', function() {
        currentFilter = 'all';
        applyFilter();
        btnFilterAll.style.display = 'none';
        btnFilterUnmatched.style.display = 'inline-block';
      });
    }

    function applyFilter() {
      var rows = tableBody.querySelectorAll('tr');
      rows.forEach(function(row) {
        if (currentFilter === 'unmatched') {
          if (row.classList.contains('matched')) {
            row.classList.add('hidden');
          } else {
            row.classList.remove('hidden');
          }
        } else {
          row.classList.remove('hidden');
        }
      });
    }
  };

  // ===========================================================
  // âœ… InvoiceOutput í˜ì´ì§€ ì´ˆê¸°í™” í•¨ìˆ˜
  // ===========================================================
  OB.invoiceOutputState = {
    allOrders: [],
    filteredOrders: [],
    currentPage: 1,
    itemsPerPage: 20,
    currentSort: {
      column: 'orderDate',
      direction: 'desc'
    },
    modesByOrder: {}
  };

  OB.initInvoiceOutputPage = function() {
    console.log('ğŸ”§ InvoiceOutput í˜ì´ì§€ ì´ˆê¸°í™” ì‹œì‘');

    var state = OB.invoiceOutputState;

    // ========================================
    // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
    // ========================================
    function formatDateInput(d) {
      if (!d) return '';
@@ -2799,54 +3183,737 @@
        var month = closing.yearMonth.substring(4, 6);
        var displayMonth = year + 'ë…„ ' + month + 'ì›”';

        var statusBadge = '<span class="status-badge ' +
          closing.status.toLowerCase() + '">' +
          closing.status + '</span>';

        tr.innerHTML =
          '<td>' + displayMonth + '</td>' +
          '<td class="status">' + statusBadge + '</td>' +
          '<td class="num">' + OB.formatNumber(closing.purchaseCount || 0) + '</td>' +
          '<td class="num">â‚©' + OB.formatNumber(closing.purchaseAmount || 0) + '</td>' +
          '<td class="num">' + OB.formatNumber(closing.salesCount || 0) + '</td>' +
          '<td class="num">â‚©' + OB.formatNumber(closing.salesAmount || 0) + '</td>' +
          '<td>' + (closing.closedAt || '-') + '</td>' +
          '<td>' + (closing.closedBy || '-') + '</td>' +
          '<td>' + (closing.unlockedAt || '-') + '</td>';

        tbody.appendChild(tr);
      });
    }

    console.log('âœ… MonthlyClosing í˜ì´ì§€ ì´ˆê¸°í™” ì™„ë£Œ');
  };

  // ========================================
  // ë§ˆê° ìƒì„¸ ê³µìš© ëª¨ë‹¬
  // ========================================
  (function() {
    var modal = document.getElementById('settlement-detail-modal');
    var closeBtn = document.getElementById('settlement-detail-close');
    var tbody = document.getElementById('settlement-detail-tbody');
    var isBound = false;

    function bindModalEvents() {
      if (isBound || !modal) return;
      if (closeBtn) {
        closeBtn.addEventListener('click', hideModal);
      }
      modal.addEventListener('click', function(e) {
        if (e.target === modal) hideModal();
      });
      isBound = true;
    }

    function hideModal() {
      if (modal) {
        modal.classList.remove('active');
      }
    }

    function renderDetail(data) {
      var settlement = data.settlement || {};
      var items = data.items || [];
      var isSales = settlement.type === 'SALES';

      document.getElementById('settlement-detail-id').textContent = settlement.settlementId || '-';
      document.getElementById('settlement-detail-type').textContent = isSales ? 'ë§¤ì¶œ ë§ˆê°' : 'ë§¤ì… ë§ˆê°';
      document.getElementById('settlement-detail-partner').textContent = settlement.partner || settlement.company || '-';
      document.getElementById('settlement-detail-period').textContent = (settlement.startDate || '-') + ' ~ ' + (settlement.endDate || '-');
      document.getElementById('settlement-detail-status').textContent = settlement.status || 'DRAFT';
      document.getElementById('settlement-detail-items').textContent = OB.formatNumber(settlement.totalItems || 0);
      document.getElementById('settlement-detail-order-qty').textContent = OB.formatNumber(settlement.totalOrderQty || 0);
      document.getElementById('settlement-detail-confirmed-qty').textContent = OB.formatNumber(settlement.totalConfirmedQty || 0);
      document.getElementById('settlement-detail-amount').textContent = 'â‚©' + OB.formatNumber(settlement.totalAmount || 0);

      document.getElementById('settlement-detail-title').textContent = (isSales ? 'ë§¤ì¶œ' : 'ë§¤ì…') + ' ë§ˆê° ìƒì„¸';
      document.getElementById('settlement-detail-price-label').textContent = isSales ? 'ë§¤ì¶œê°€' : 'ë§¤ì…ê°€';
      document.getElementById('settlement-detail-amount-label').textContent = isSales ? 'ë§¤ì¶œì•¡' : 'ë§¤ì…ì•¡';

      if (!items.length) {
        tbody.innerHTML = '<tr><td colspan="11" class="settlement-detail-empty">ë§ˆê° ìƒì„¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
      } else {
        var rows = items.map(function(item) {
          var diffQty = (item.orderQty || 0) - (item.confirmedQty || 0);
          var unitPrice = isSales ? (item.supplyPrice || 0) : (item.buyPrice || 0);
          var amount = isSales ? (item.supplyAmount || 0) : (item.purchaseAmount || 0);
          var counterParty = isSales ? (item.supplier || '') : (item.buyer || '');

          return '<tr>' +
            '<td>' + (item.orderCode || '') + '</td>' +
            '<td>' + (item.orderDate || '') + '</td>' +
            '<td>' + counterParty + '</td>' +
            '<td>' + (item.brand || '') + '</td>' +
            '<td>' + (item.productName || '') + '</td>' +
            '<td>' + (item.productCode || '') + '</td>' +
            '<td class="num">' + OB.formatNumber(item.orderQty || 0) + '</td>' +
            '<td class="num">' + OB.formatNumber(item.confirmedQty || 0) + '</td>' +
            '<td class="num">' + OB.formatNumber(diffQty) + '</td>' +
            '<td class="num">â‚©' + OB.formatNumber(unitPrice) + '</td>' +
            '<td class="num">â‚©' + OB.formatNumber(amount) + '</td>' +
          '</tr>';
        }).join('');

        tbody.innerHTML = rows;
      }

      if (modal) {
        modal.classList.add('active');
      }
    }

    OB.viewSettlementDetail = function(settlementId, type) {
      if (!modal) {
        alert('ìƒì„¸ ëª¨ë‹¬ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      if (!settlementId) {
        alert('ë§ˆê°IDê°€ í•„ìš”í•©ë‹ˆë‹¤.');
        return;
      }

      bindModalEvents();
      OB.showLoading('ë§ˆê° ìƒì„¸ ì¡°íšŒ ì¤‘...');

      google.script.run
        .withSuccessHandler(function(result) {
          OB.hideLoading();

          if (!result || !result.success) {
            alert('ë§ˆê° ìƒì„¸ ì¡°íšŒ ì‹¤íŒ¨: ' + (result ? result.error : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
            return;
          }

          renderDetail(result);
        })
        .withFailureHandler(function(error) {
          OB.hideLoading();
          alert('ë§ˆê° ìƒì„¸ ì¡°íšŒ ì‹¤íŒ¨: ' + error.message);
        })
        .getSettlementDetailApi({ settlementId: settlementId, type: type });
    };
  })();

  // ========================================
  // ê±°ë˜ì›ì¥ (Transaction Ledger)
  // ========================================
  OB.transactionLedgerState = {
    raw: [],
    filtered: []
  };

  OB.initTransactionLedgerPage = function() {
    console.log('ğŸ”„ TransactionLedger í˜ì´ì§€ ì´ˆê¸°í™” ì‹œì‘...');

    var state = OB.transactionLedgerState;

    var startDateInput = document.getElementById('ledger-start-date');
    var endDateInput = document.getElementById('ledger-end-date');
    var companyInput = document.getElementById('ledger-company');
    var statusSelect = document.getElementById('ledger-status');
    var orderCodeInput = document.getElementById('ledger-order-code');
    var searchBtn = document.getElementById('ledger-search-btn');
    var resetBtn = document.getElementById('ledger-reset-btn');
    var tbody = document.getElementById('ledger-tbody');

    var summaryCount = document.getElementById('ledger-summary-count');
    var summaryOrderQty = document.getElementById('ledger-summary-order-qty');
    var summaryConfirmedQty = document.getElementById('ledger-summary-confirmed-qty');
    var summaryAmount = document.getElementById('ledger-summary-amount');

    var today = new Date();
    var firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
    startDateInput.value = formatDateInput(firstDay);
    endDateInput.value = formatDateInput(today);

    function formatDateInput(date) {
      var y = date.getFullYear();
      var m = String(date.getMonth() + 1).padStart(2, '0');
      var d = String(date.getDate()).padStart(2, '0');
      return y + '-' + m + '-' + d;
    }

    function parseDate(value) {
      if (!value) return null;
      var d = value instanceof Date ? value : new Date(value);
      return isNaN(d.getTime()) ? null : d;
    }

    function applyFilters() {
      var start = parseDate(startDateInput.value);
      var end = parseDate(endDateInput.value);
      var company = (companyInput.value || '').trim();
      var status = statusSelect.value;
      var orderCode = (orderCodeInput.value || '').trim();

      state.filtered = state.raw.filter(function(tx) {
        var keep = true;

        if (orderCode) {
          keep = keep && String(tx['ë°œì£¼ë²ˆí˜¸'] || '').indexOf(orderCode) !== -1;
        }

        if (company) {
          keep = keep && String(tx['ë°œì£¼ì²˜'] || '').indexOf(company) !== -1;
        }

        if (status) {
          keep = keep && String(tx['ìƒíƒœ'] || '').toUpperCase() === status.toUpperCase();
        }

        if (start || end) {
          var orderDate = parseDate(tx['ë°œì£¼ì¼']);
          if (start && (!orderDate || orderDate < start)) keep = false;
          if (end && (!orderDate || orderDate > end)) keep = false;
        }

        return keep;
      });

      renderSummary();
      renderTable();
    }

    function renderSummary() {
      var totalOrderQty = 0;
      var totalConfirmedQty = 0;
      var totalAmount = 0;

      state.filtered.forEach(function(tx) {
        totalOrderQty += Number(tx['ë°œì£¼ìˆ˜ëŸ‰']) || 0;
        totalConfirmedQty += Number(tx['í™•ì •ìˆ˜ëŸ‰']) || 0;
        totalAmount += Number(tx['ê³µê¸‰ì•¡']) || 0;
      });

      summaryCount.textContent = (state.filtered.length || 0) + 'ê±´';
      summaryOrderQty.textContent = OB.formatNumber(totalOrderQty);
      summaryConfirmedQty.textContent = OB.formatNumber(totalConfirmedQty);
      summaryAmount.textContent = 'â‚©' + OB.formatNumber(totalAmount);
    }

    function buildStatusSelect(current) {
      var select = document.createElement('select');
      select.className = 'ledger-status-select';
      var options = ['DRAFT', 'CONFIRMED', 'ISSUED', 'PAID', 'CANCELLED'];

      if (current && options.indexOf(current) === -1) {
        options.unshift(current);
      }

      options.forEach(function(opt) {
        var optionEl = document.createElement('option');
        optionEl.value = opt;
        optionEl.textContent = opt;
        if (current === opt) {
          optionEl.selected = true;
        }
        select.appendChild(optionEl);
      });

      return select;
    }

    function renderTable() {
      if (!tbody) return;

      if (!state.filtered.length) {
        tbody.innerHTML = '<tr><td colspan="12" class="ledger-empty">ì¡°íšŒ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        return;
      }

      tbody.innerHTML = '';

      state.filtered.forEach(function(tx) {
        var tr = document.createElement('tr');

        function td(text, cls) {
          var cell = document.createElement('td');
          cell.textContent = text;
          if (cls) cell.className = cls;
          tr.appendChild(cell);
        }

        td(OB.formatDate(tx['ë°œì£¼ì¼']));
        td(tx['ë°œì£¼ë²ˆí˜¸'] || '-');
        td(tx['ë°œì£¼ì²˜'] || '-');
        td(tx['ë¸Œëœë“œ'] || '-');
        td(tx['í’ˆëª©ì½”ë“œ'] || '-');
        td(tx['ì œí’ˆëª…'] || '-');
        td(OB.formatNumber(tx['ë°œì£¼ìˆ˜ëŸ‰'] || 0), 'num');
        td(OB.formatNumber(tx['í™•ì •ìˆ˜ëŸ‰'] || 0), 'num');
        td(OB.formatNumber(tx['ê³µê¸‰ê°€'] || 0), 'num');
        td(OB.formatNumber(tx['ê³µê¸‰ì•¡'] || 0), 'num');

        var statusTd = document.createElement('td');
        var badge = document.createElement('span');
        badge.className = 'ledger-status-badge';
        badge.textContent = tx['ìƒíƒœ'] || 'N/A';
        statusTd.appendChild(badge);
        tr.appendChild(statusTd);

        var actionTd = document.createElement('td');
        actionTd.className = 'ledger-action-group';

        var select = buildStatusSelect(tx['ìƒíƒœ']);
        var btn = document.createElement('button');
        btn.className = 'ledger-btn primary';
        btn.textContent = 'ìƒíƒœ ë³€ê²½';

        btn.addEventListener('click', function() {
          var next = select.value;
          if (!next) {
            alert('ë³€ê²½í•  ìƒíƒœë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
            return;
          }

          OB.showLoading('ìƒíƒœ ë³€ê²½ ì¤‘...');

          google.script.run
            .withSuccessHandler(function(res) {
              OB.hideLoading();

              if (!res || !res.success) {
                alert('ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨: ' + (res ? res.error : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                return;
              }

              alert('ìƒíƒœê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
              fetchTransactions();
            })
            .withFailureHandler(function(err) {
              OB.hideLoading();
              alert('ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨: ' + err.message);
            })
            .updateTransactionStateApi({ rowIndex: tx._rowIndex, state: next });
        });

        actionTd.appendChild(select);
        actionTd.appendChild(btn);
        tr.appendChild(actionTd);

        tbody.appendChild(tr);
      });
    }

    function fetchTransactions() {
      var orderCode = (orderCodeInput.value || '').trim();

      OB.showLoading('ê±°ë˜ì›ì¥ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');

      google.script.run
        .withSuccessHandler(function(result) {
          OB.hideLoading();

          if (!result || !result.success) {
            alert('ê±°ë˜ì›ì¥ ì¡°íšŒ ì‹¤íŒ¨: ' + (result ? result.error : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
            return;
          }

          state.raw = result.transactions || [];
          applyFilters();
        })
        .withFailureHandler(function(error) {
          OB.hideLoading();
          alert('ê±°ë˜ì›ì¥ ì¡°íšŒ ì‹¤íŒ¨: ' + error.message);
        })
        .getTransactionsApi({ orderCode: orderCode });
    }

    searchBtn.addEventListener('click', function() {
      fetchTransactions();
    });

    resetBtn.addEventListener('click', function() {
      companyInput.value = '';
      statusSelect.value = '';
      orderCodeInput.value = '';
      startDateInput.value = formatDateInput(firstDay);
      endDateInput.value = formatDateInput(today);
      state.filtered = state.raw.slice();
      applyFilters();
    });

    // ì´ˆê¸° ì¡°íšŒ
    fetchTransactions();

    console.log('âœ… TransactionLedger í˜ì´ì§€ ì´ˆê¸°í™” ì™„ë£Œ');
  };

  // ========================================
  // ì¸ë³´ì´ìŠ¤ ê´€ë¦¬ (Invoice Management)
  // ========================================
  OB.invoiceManagementState = {
    aggItems: [],
    aggAmount: 0,
    invoices: []
  };

  OB.initInvoiceManagementPage = function() {
    console.log('ğŸ”„ InvoiceManagement í˜ì´ì§€ ì´ˆê¸°í™” ì‹œì‘...');

    var state = OB.invoiceManagementState;

    // ì§‘ê³„ UI
    var aggCompany = document.getElementById('invoice-agg-company');
    var aggStart = document.getElementById('invoice-agg-start');
    var aggEnd = document.getElementById('invoice-agg-end');
    var aggBtn = document.getElementById('invoice-agg-btn');
    var aggSummary = document.getElementById('invoice-agg-summary');
    var aggTableWrap = document.getElementById('invoice-agg-table-wrap');
    var aggTbody = document.getElementById('invoice-agg-tbody');
    var aggItemsEl = document.getElementById('invoice-agg-items');
    var aggOrderQtyEl = document.getElementById('invoice-agg-order-qty');
    var aggConfirmedQtyEl = document.getElementById('invoice-agg-confirmed-qty');
    var aggAmountEl = document.getElementById('invoice-agg-amount');

    // ìƒì„± UI
    var createSettlement = document.getElementById('invoice-create-settlement');
    var createType = document.getElementById('invoice-create-type');
    var createCompany = document.getElementById('invoice-create-company');
    var createDate = document.getElementById('invoice-create-date');
    var createAmount = document.getElementById('invoice-create-amount');
    var createNotes = document.getElementById('invoice-create-notes');
    var createBtn = document.getElementById('invoice-create-btn');

    // ëª©ë¡ UI
    var filterType = document.getElementById('invoice-filter-type');
    var filterCompany = document.getElementById('invoice-filter-company');
    var filterStatus = document.getElementById('invoice-filter-status');
    var filterStart = document.getElementById('invoice-filter-start');
    var filterEnd = document.getElementById('invoice-filter-end');
    var searchBtn = document.getElementById('invoice-search-btn');
    var resetBtn = document.getElementById('invoice-reset-btn');
    var listTbody = document.getElementById('invoice-list-tbody');
    var listCount = document.getElementById('invoice-list-count');
    var listAmount = document.getElementById('invoice-list-amount');

    var today = new Date();
    var firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
    aggStart.value = formatDateInput(firstDay);
    aggEnd.value = formatDateInput(today);
    filterStart.value = formatDateInput(firstDay);
    filterEnd.value = formatDateInput(today);
    createDate.value = formatDateInput(today);

    function formatDateInput(date) {
      var y = date.getFullYear();
      var m = String(date.getMonth() + 1).padStart(2, '0');
      var d = String(date.getDate()).padStart(2, '0');
      return y + '-' + m + '-' + d;
    }

    function renderAggTable(items) {
      if (!items || !items.length) {
        aggTbody.innerHTML = '<tr><td colspan="8" class="invoice-empty">ì§‘ê³„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        return;
      }

      aggTbody.innerHTML = '';

      items.forEach(function(item) {
        var tr = document.createElement('tr');
        function td(text, cls) {
          var cell = document.createElement('td');
          cell.textContent = text;
          if (cls) cell.className = cls;
          tr.appendChild(cell);
        }

        td(item.orderDate || '-');
        td(item.orderCode || '-');
        td(item.supplier || '-');
        td(item.brand || '-');
        td(item.productName || '-');
        td(OB.formatNumber(item.confirmedQty || 0), 'num');
        td(OB.formatNumber(item.supplyPrice || 0), 'num');
        td(OB.formatNumber(item.supplyAmount || 0), 'num');

        aggTbody.appendChild(tr);
      });
    }

    function renderAggSummary(result) {
      aggItemsEl.textContent = OB.formatNumber(result.totalItems || 0);
      aggOrderQtyEl.textContent = OB.formatNumber(result.totalOrderQty || 0);
      aggConfirmedQtyEl.textContent = OB.formatNumber(result.totalConfirmedQty || 0);
      aggAmountEl.textContent = 'â‚©' + OB.formatNumber(result.totalAmount || 0);
    }

    function aggregate() {
      var company = (aggCompany.value || '').trim();
      var startDate = aggStart.value;
      var endDate = aggEnd.value;

      OB.showLoading('ì²­êµ¬ ë°ì´í„° ì§‘ê³„ ì¤‘...');

      google.script.run
        .withSuccessHandler(function(res) {
          OB.hideLoading();

          if (!res || !res.success) {
            alert('ì§‘ê³„ ì‹¤íŒ¨: ' + (res ? res.error : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
            return;
          }

          state.aggItems = res.items || [];
          state.aggAmount = res.totalAmount || 0;

          renderAggSummary(res);
          renderAggTable(state.aggItems);
          aggSummary.style.display = 'grid';
          aggTableWrap.style.display = 'block';

          if (company) {
            createCompany.value = company;
          }
          if (state.aggAmount) {
            createAmount.value = state.aggAmount;
          }
        })
        .withFailureHandler(function(err) {
          OB.hideLoading();
          alert('ì§‘ê³„ ì‹¤íŒ¨: ' + err.message);
        })
        .aggregateInvoiceDataApi({ company: company, startDate: startDate, endDate: endDate });
    }

    aggBtn.addEventListener('click', aggregate);

    function createInvoice() {
      var settlementId = (createSettlement.value || '').trim();
      var type = createType.value;
      var company = (createCompany.value || '').trim();
      var invoiceDate = createDate.value;
      var amount = Number(createAmount.value) || 0;
      var notes = (createNotes.value || '').trim();

      if (!settlementId || !type || !company) {
        alert('ë§ˆê° ID, ìœ í˜•, ê±°ë˜ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      if (!amount && state.aggAmount) {
        amount = state.aggAmount;
      }

      OB.showLoading('ì²­êµ¬ì„œ ìƒì„± ì¤‘...');

      google.script.run
        .withSuccessHandler(function(res) {
          OB.hideLoading();

          if (!res || !res.success) {
            alert('ì²­êµ¬ì„œ ìƒì„± ì‹¤íŒ¨: ' + (res ? res.error : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
            return;
          }

          alert('ì²­êµ¬ì„œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! ID: ' + res.invoiceId);
          loadInvoices();
        })
        .withFailureHandler(function(err) {
          OB.hideLoading();
          alert('ì²­êµ¬ì„œ ìƒì„± ì‹¤íŒ¨: ' + err.message);
        })
        .createInvoiceFromSettlementApi({
          settlementId: settlementId,
          type: type,
          company: company,
          invoiceDate: invoiceDate,
          amount: amount,
          notes: notes
        });
    }

    createBtn.addEventListener('click', createInvoice);

    function renderInvoiceTable(list) {
      if (!list || !list.length) {
        listTbody.innerHTML = '<tr><td colspan="9" class="invoice-empty">ì¡°íšŒëœ ì¸ë³´ì´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        return;
      }

      listTbody.innerHTML = '';

      list.forEach(function(inv) {
        var tr = document.createElement('tr');

        function td(text, cls) {
          var cell = document.createElement('td');
          cell.textContent = text;
          if (cls) cell.className = cls;
          tr.appendChild(cell);
        }

        td(inv.invoiceId || '-');
        td(inv.type || '-');
        td(inv.company || '-');
        td(inv.settlementId || '-');
        td(inv.invoiceDate || '-');
        td(OB.formatNumber(inv.amount || 0), 'num');

        var statusTd = document.createElement('td');
        var badge = document.createElement('span');
        badge.className = 'invoice-badge';
        badge.textContent = inv.status || 'N/A';
        statusTd.appendChild(badge);
        tr.appendChild(statusTd);

        td(inv.notes || '-');

        var actionTd = document.createElement('td');
        var btn = document.createElement('button');
        btn.className = 'invoice-btn primary';
        btn.textContent = 'ìƒíƒœ ë³€ê²½';

        btn.addEventListener('click', function() {
          var nextStatus = '';
          var status = inv.status || 'DRAFT';

          if (status === 'DRAFT') {
            nextStatus = 'ISSUED';
          } else if (status === 'ISSUED') {
            nextStatus = 'PAID';
          } else {
            alert('ë³€ê²½ ê°€ëŠ¥í•œ ìƒíƒœê°€ ì—†ìŠµë‹ˆë‹¤.');
            return;
          }

          if (!confirm('ìƒíƒœë¥¼ ' + nextStatus + ' ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

          OB.showLoading('ì¸ë³´ì´ìŠ¤ ìƒíƒœ ë³€ê²½ ì¤‘...');

          google.script.run
            .withSuccessHandler(function(res) {
              OB.hideLoading();

              if (!res || !res.success) {
                alert('ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨: ' + (res ? res.error : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                return;
              }

              alert('ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
              loadInvoices();
            })
            .withFailureHandler(function(err) {
              OB.hideLoading();
              alert('ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨: ' + err.message);
            })
            .updateInvoiceStatusApi({ invoiceId: inv.invoiceId, status: nextStatus });
        });

        actionTd.appendChild(btn);
        tr.appendChild(actionTd);

        listTbody.appendChild(tr);
      });
    }

    function renderInvoiceSummary(list) {
      var totalAmount = 0;
      list.forEach(function(inv) {
        totalAmount += Number(inv.amount) || 0;
      });

      listCount.textContent = (list.length || 0) + 'ê±´';
      listAmount.textContent = 'â‚©' + OB.formatNumber(totalAmount);
    }

    function loadInvoices() {
      var params = {
        type: filterType.value,
        company: (filterCompany.value || '').trim(),
        status: filterStatus.value,
        startDate: filterStart.value,
        endDate: filterEnd.value
      };

      OB.showLoading('ì¸ë³´ì´ìŠ¤ ëª©ë¡ ì¡°íšŒ ì¤‘...');

      google.script.run
        .withSuccessHandler(function(res) {
          OB.hideLoading();

          if (!res || !res.success) {
            alert('ì¡°íšŒ ì‹¤íŒ¨: ' + (res ? res.error : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
            return;
          }

          state.invoices = res.invoices || [];
          renderInvoiceTable(state.invoices);
          renderInvoiceSummary(state.invoices);
        })
        .withFailureHandler(function(err) {
          OB.hideLoading();
          alert('ì¡°íšŒ ì‹¤íŒ¨: ' + err.message);
        })
        .getInvoicesApi(params);
    }

    searchBtn.addEventListener('click', loadInvoices);

    resetBtn.addEventListener('click', function() {
      filterType.value = '';
      filterCompany.value = '';
      filterStatus.value = '';
      filterStart.value = formatDateInput(firstDay);
      filterEnd.value = formatDateInput(today);
      loadInvoices();
    });

    // ì´ˆê¸° ë°ì´í„°
    aggregate();
    loadInvoices();

    console.log('âœ… InvoiceManagement í˜ì´ì§€ ì´ˆê¸°í™” ì™„ë£Œ');
  };

  // ========================================
  // ì²­êµ¬ì„œ ê´€ë¦¬ í˜ì´ì§€ (BillingManagement)
  // ========================================
  window.initBillingManagementPage = function() {
  OB.initBillingManagementPage = function() {
    console.log('ğŸ”„ BillingManagement í˜ì´ì§€ ì´ˆê¸°í™” ì‹œì‘...');

    // DOM ìš”ì†Œ
    var companyInput = document.getElementById('billing-mgmt-company');
    var statusSelect = document.getElementById('billing-mgmt-status');
    var startDateInput = document.getElementById('billing-mgmt-start-date');
    var endDateInput = document.getElementById('billing-mgmt-end-date');
    var searchBtn = document.getElementById('billing-mgmt-search-btn');
    var resetBtn = document.getElementById('billing-mgmt-reset-btn');

    var summaryDiv = document.getElementById('billing-mgmt-summary');
    var totalCountSpan = document.getElementById('billing-mgmt-total-count');
    var totalAmountSpan = document.getElementById('billing-mgmt-total-amount');
    var issuedAmountSpan = document.getElementById('billing-mgmt-issued-amount');
    var unpaidAmountSpan = document.getElementById('billing-mgmt-unpaid-amount');

    var tbody = document.getElementById('billing-mgmt-tbody');

    var detailModal = document.getElementById('billing-detail-modal');
    var modalCloseBtn = document.getElementById('billing-modal-close-btn');
    var detailReprintBtn = document.getElementById('billing-detail-reprint-btn');
    var detailChangeStatusBtn = document.getElementById('billing-detail-change-status-btn');

    // í˜„ì¬ ì„ íƒëœ ì²­êµ¬ì„œ
    var currentBilling = null;
@@ -2946,173 +4013,206 @@
        }
      });

      var unpaidAmount = issuedAmount - paidAmount;

      totalCountSpan.textContent = OB.formatNumber(totalCount);
      totalAmountSpan.textContent = 'â‚©' + OB.formatNumber(totalAmount);
      issuedAmountSpan.textContent = 'â‚©' + OB.formatNumber(issuedAmount);
      unpaidAmountSpan.textContent = 'â‚©' + OB.formatNumber(unpaidAmount);
    }

    // í…Œì´ë¸” ë Œë”ë§
    function renderTable(billings) {
      if (!billings || billings.length === 0) {
        tbody.innerHTML =
          '<tr><td colspan="8" class="billing-empty">' +
          '<div class="billing-empty-icon">ğŸ“‹</div>' +
          '<div class="billing-empty-text">ì¡°íšŒ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>' +
          '</td></tr>';
        return;
      }

      tbody.innerHTML = '';

      billings.forEach(function(billing) {
        var invoiceId = billing.invoiceId || billing.billingId || '';
        var tr = document.createElement('tr');

        var statusBadge = '<span class="billing-status-badge ' +
          billing.status + '">' +
          getStatusText(billing.status) + '</span>';

        var typeText = billing.type === 'PURCHASE' ? 'ë§¤ì…' : 'ë§¤ì¶œ';

        tr.innerHTML =
          '<td>' + billing.billingId + '</td>' +
          '<td>' + invoiceId + '</td>' +
          '<td>' + typeText + '</td>' +
          '<td>' + billing.company + '</td>' +
          '<td>' + billing.billingDate + '</td>' +
          '<td class="num">â‚©' + OB.formatNumber(billing.amount) + '</td>' +
          '<td class="center">' + statusBadge + '</td>' +
          '<td>' + (billing.notes || '-') + '</td>' +
          '<td class="center">' +
          '<button class="billing-btn primary small" data-billing-id="' + billing.billingId + '">ìƒì„¸</button>' +
          '<button class="billing-btn primary small" data-billing-id="' + invoiceId + '">ìƒì„¸</button>' +
          '</td>';

        tbody.appendChild(tr);
      });

      // ìƒì„¸ë³´ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
      tbody.querySelectorAll('button[data-billing-id]').forEach(function(btn) {
        btn.addEventListener('click', function() {
          var billingId = this.getAttribute('data-billing-id');
          var billing = billings.find(function(b) { return b.billingId === billingId; });
          var billing = billings.find(function(b) {
            return (b.invoiceId || b.billingId) === billingId;
          });
          if (billing) {
            showDetailModal(billing);
          }
        });
      });
    }

    function getStatusText(status) {
      switch (status) {
        case 'DRAFT': return 'ì„ì‹œì €ì¥';
        case 'ISSUED': return 'ë°œí–‰ì™„ë£Œ';
        case 'PAID': return 'ì…ê¸ˆì™„ë£Œ';
        default: return status;
      }
    }

    // ìƒì„¸ë³´ê¸° ëª¨ë‹¬ ì—´ê¸°
    function showDetailModal(billing) {
      currentBilling = billing;

      document.getElementById('detail-billing-id').textContent = billing.billingId || '-';
      document.getElementById('detail-billing-id').textContent = billing.invoiceId || billing.billingId || '-';
      document.getElementById('detail-type').textContent = billing.type === 'PURCHASE' ? 'ë§¤ì…' : 'ë§¤ì¶œ';
      document.getElementById('detail-company').textContent = billing.company || '-';
      document.getElementById('detail-settlement-id').textContent = billing.settlementId || '-';
      document.getElementById('detail-billing-date').textContent = billing.billingDate || '-';
      document.getElementById('detail-amount').textContent = 'â‚©' + OB.formatNumber(billing.amount);
      document.getElementById('detail-status').textContent = getStatusText(billing.status);
      document.getElementById('detail-notes').textContent = billing.notes || '-';

      document.getElementById('detail-created-at').textContent = billing.createdAt || '-';
      document.getElementById('detail-created-by').textContent = billing.createdBy || '-';
      document.getElementById('detail-issued-at').textContent = billing.issuedAt || '-';
      document.getElementById('detail-issued-by').textContent = billing.issuedBy || '-';
      document.getElementById('detail-paid-at').textContent = billing.paidAt || '-';

      detailModal.classList.add('active');
    }

    // ëª¨ë‹¬ ë‹«ê¸°
    modalCloseBtn.addEventListener('click', function() {
      detailModal.classList.remove('active');
      currentBilling = null;
    });

    // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
    detailModal.addEventListener('click', function(e) {
      if (e.target === detailModal) {
        detailModal.classList.remove('active');
        currentBilling = null;
      }
    });

    // ì¬ì¶œë ¥ ë²„íŠ¼
    detailReprintBtn.addEventListener('click', function() {
      if (!currentBilling) return;
      alert('ì²­êµ¬ì„œ ì¬ì¶œë ¥ ê¸°ëŠ¥ì€ ì¶”í›„ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤.');
      // TODO: ì²­êµ¬ì„œ PDF ì¬ì¶œë ¥ ê¸°ëŠ¥ êµ¬í˜„

      var invoiceId = currentBilling.invoiceId || currentBilling.billingId;
      if (!invoiceId) {
        alert('ì²­êµ¬IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      OB.showLoading('ì²­êµ¬ì„œ ì¬ì¶œë ¥ ì¤‘...');

      google.script.run
        .withSuccessHandler(function(result) {
          OB.hideLoading();

          if (!result || !result.success) {
            alert('ì¬ì¶œë ¥ ì‹¤íŒ¨: ' + (result ? result.error : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
            return;
          }

          var url = 'https://drive.google.com/uc?export=download&id=' + result.fileId;
          window.open(url, '_blank');
          alert('PDF ì¬ì¶œë ¥ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\níŒŒì¼: ' + result.fileName);
        })
        .withFailureHandler(function(error) {
          OB.hideLoading();
          alert('ì¬ì¶œë ¥ ì‹¤íŒ¨: ' + error.message);
        })
        .reprintInvoiceApi({
          invoiceId: invoiceId,
          billingId: invoiceId,
          settlementId: currentBilling.settlementId,
          type: currentBilling.type
        });
    });

    // ìƒíƒœ ë³€ê²½ ë²„íŠ¼
    detailChangeStatusBtn.addEventListener('click', function() {
      if (!currentBilling) return;

      var nextStatus = '';
      var nextStatusText = '';

      if (currentBilling.status === 'DRAFT') {
        nextStatus = 'ISSUED';
        nextStatusText = 'ë°œí–‰ì™„ë£Œ';
      } else if (currentBilling.status === 'ISSUED') {
        nextStatus = 'PAID';
        nextStatusText = 'ì…ê¸ˆì™„ë£Œ';
      } else {
        alert('ë” ì´ìƒ ë³€ê²½í•  ìˆ˜ ì—†ëŠ” ìƒíƒœì…ë‹ˆë‹¤.');
        return;
      }

      var confirmMsg = 'ì²­êµ¬ì„œ ìƒíƒœë¥¼ "' + nextStatusText + '"ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?';
      if (!confirm(confirmMsg)) return;

      OB.showLoading('ìƒíƒœ ë³€ê²½ ì¤‘...');

      google.script.run
        .withSuccessHandler(function(result) {
          OB.hideLoading();

          if (!result || !result.success) {
            alert('ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨: ' + (result ? result.error : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
            return;
          }

          alert('ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!');
          detailModal.classList.remove('active');
          currentBilling = null;

          // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          searchBtn.click();
        })
        .withFailureHandler(function(error) {
          OB.hideLoading();
          alert('ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨: ' + error.message);
        })
        .updateBillingStatusApi({
          billingId: currentBilling.billingId,
          billingId: currentBilling.billingId || currentBilling.invoiceId,
          status: nextStatus
        });
    });

    console.log('âœ… BillingManagement í˜ì´ì§€ ì´ˆê¸°í™” ì™„ë£Œ');
  };

</script>

<!-- ì „ì—­ ë¡œë”© ì˜¤ë²„ë ˆì´ -->
<div id="ob-loading-overlay" class="ob-loading-overlay">
  <div class="ob-loading-box">
    <div class="ob-spinner"></div>
    <div id="ob-loading-text">ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...</div>
  </div>
</div>
Component_Sidebar.html
+18
-0

@@ -13,63 +13,81 @@
    </li>
    <li class="ob-nav-item">
      <a href="#" class="ob-nav-link" data-nav-page="orderList">
        <span class="ob-nav-icon">ğŸ§¾</span>
        <span>ë°œì£¼ ë‚´ì—­</span>
      </a>
    </li>
  </ul>
</div>

<div>
  <div class="ob-sidebar-section-title">ì¡°íšŒ / ì¶œë ¥</div>
  <ul class="ob-nav-list">
    <li class="ob-nav-item">
      <a href="#" class="ob-nav-link" data-nav-page="dashboard">
        <span class="ob-nav-icon">ğŸ“Š</span>
        <span>ëŒ€ì‹œë³´ë“œ</span>
      </a>
    </li>
    <li class="ob-nav-item">
      <a href="#" class="ob-nav-link" data-nav-page="invoiceOutput">
        <span class="ob-nav-icon">ğŸ–¨ï¸</span>
        <span>ì¶œë ¥ / ëª…ì„¸ì„œ</span>
      </a>
    </li>
    <li class="ob-nav-item">
      <a href="#" class="ob-nav-link" data-nav-page="transactionLedger">
        <span class="ob-nav-icon">ğŸ“’</span>
        <span>ê±°ë˜ì›ì¥</span>
      </a>
    </li>
  </ul>
</div>

<div>
  <div class="ob-sidebar-section-title">íšŒê³„ ê´€ë¦¬</div>
  <ul class="ob-nav-list">
    <li class="ob-nav-item">
      <a href="#" class="ob-nav-link" data-nav-page="purchaseSettlement">
        <span class="ob-nav-icon">ğŸ’°</span>
        <span>ë§¤ì… ë§ˆê°</span>
      </a>
    </li>
    <li class="ob-nav-item">
      <a href="#" class="ob-nav-link" data-nav-page="salesSettlement">
        <span class="ob-nav-icon">ğŸ’³</span>
        <span>ë§¤ì¶œ ë§ˆê°</span>
      </a>
    </li>
    <li class="ob-nav-item">
      <a href="#" class="ob-nav-link" data-nav-page="monthlyClosing">
        <span class="ob-nav-icon">ğŸ“…</span>
        <span>ì›”ë³„ ë§ˆê°</span>
      </a>
    </li>
    <li class="ob-nav-item">
      <a href="#" class="ob-nav-link" data-nav-page="billingManagement">
        <span class="ob-nav-icon">ğŸ§¾</span>
        <span>ì²­êµ¬ì„œ ê´€ë¦¬</span>
      </a>
    </li>
    <li class="ob-nav-item">
      <a href="#" class="ob-nav-link" data-nav-page="invoiceManagement">
        <span class="ob-nav-icon">ğŸ“‘</span>
        <span>ì¸ë³´ì´ìŠ¤ ê´€ë¦¬</span>
      </a>
    </li>
  </ul>
</div>

<div>
  <div class="ob-sidebar-section-title">ì„¤ì •</div>
  <ul class="ob-nav-list">
    <li class="ob-nav-item">
      <a href="#" class="ob-nav-link" data-nav-page="settings">
        <span class="ob-nav-icon">âš™ï¸</span>
        <span>ê¸°ì´ˆë°ì´í„° / ì„¤ì •</span>
      </a>
    </li>
  </ul>
</div>
InstructionUnderstanding.md
ì‹ ê·œ
+15
-0

# ì‘ì—… ì§€ì‹œì‚¬í•­ ì´í•´ í™•ì¸

## í˜„ì¬ê¹Œì§€ íŒŒì•…í•œ í•µì‹¬ ì§€ì¹¨
- **í•œêµ­ì–´ ì‘ë‹µ**: ì‚¬ìš©ìì™€ì˜ ëª¨ë“  ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ì€ í•œêµ­ì–´ë¡œ ì§„í–‰í•©ë‹ˆë‹¤.
- **ë¸Œëœì¹˜ ìƒíƒœ**: `work` ë¸Œëœì¹˜ì—ì„œ ìµœì‹  íŒŒì¼ì„ ê¸°ì¤€ìœ¼ë¡œ ì‘ì—…í•˜ë©°, ê¸°ì¡´ ì‘ì—…ê³¼ ì¶©ëŒì„ í”¼í•©ë‹ˆë‹¤.
- **ì•„í‚¤í…ì²˜ ì¤€ìˆ˜**: `OneBridge_ERP_Architecture_v2.2.md`ì™€ ë¬¸ì„œí™”ëœ SSR+SPA í•˜ì´ë¸Œë¦¬ë“œ êµ¬ì¡°, `CommonScripts.html` ì¤‘ì‹¬ì˜ ì´ˆê¸°í™” ê·œì¹™ì„ ë”°ë¦…ë‹ˆë‹¤.
- **ë³€ê²½ ê´€ë¦¬**: ë³€ê²½ ì‚¬í•­ì€ ì»¤ë°‹ í›„ PR ë©”ì‹œì§€ë¡œ ì •ë¦¬í•˜ë©°, ì½”ë“œ/ë¬¸ì„œì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì—¬ë¶€ë¥¼ ëª…í™•íˆ ë³´ê³ í•©ë‹ˆë‹¤.
- **ê²€ì¦ í•œê³„ ëª…ì‹œ**: Google Apps Script í™˜ê²½(`google.script.run`) ì˜ì¡´ ê¸°ëŠ¥ì€ ë¡œì»¬ ì •ì  HTMLë§Œìœ¼ë¡œ ì‹¤í–‰ë˜ì§€ ì•ŠìŒì„ í…ŒìŠ¤íŠ¸ ë³´ê³ ì„œì— ê¸°ë¡í–ˆìŠµë‹ˆë‹¤.

## ì´í›„ ì‘ì—… ì›ì¹™
- ë¯¸êµ¬í˜„/ë¯¸ì—°ë™ ê¸°ëŠ¥(UIì™€ API ì—°ê²°, ìƒíƒœ ë³€ê²½, PDF ì¶œë ¥ ë“±)ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì¶©ëŒ ì—†ì´ ë³´ì™„í•©ë‹ˆë‹¤.
- í˜ì´ì§€ë³„ ì´ˆê¸°í™” í•¨ìˆ˜(`init*Page`)ì™€ ê³µí†µ ë¡œë”©/ì•Œë¦¼ íë¦„ì„ ìœ ì§€í•˜ë©°, ìƒˆ ê¸°ëŠ¥ ì¶”ê°€ ì‹œ ëª¨í‚¹ ë˜ëŠ” ì‹¤ì œ API ì—°ë™ ì—¬ë¶€ë¥¼ ëª…í™•íˆ êµ¬ë¶„í•©ë‹ˆë‹¤.
- ì‚¬ìš©ì ì œê³µ ì‹œë‚˜ë¦¬ì˜¤(`UserSimulationScenarios.md`)ì™€ í…ŒìŠ¤íŠ¸ ë³´ê³ ì„œ(`TestExecutionReport.md`)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¬í˜„ ê°€ëŠ¥í•œ ê²€ì¦ ë‹¨ê³„ë¥¼ ì¶”ê°€í•´ ë‚˜ê°‘ë‹ˆë‹¤.

ìœ„ ì§€ì¹¨ì„ ì¤€ìˆ˜í•˜ë©° ì´í›„ ë³€ê²½ ì‚¬í•­ì„ ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤.
InvoiceService.js
+113
-0

@@ -374,50 +374,163 @@ function updateInvoiceStatus(params) {
      sheet.getRange(rowIndex, 11).setValue(now);
      sheet.getRange(rowIndex, 12).setValue(user);
    }

    // PAIDë¡œ ë³€ê²½ ì‹œ ê²°ì œ ì¼ì‹œ ê¸°ë¡
    if (status === 'PAID') {
      sheet.getRange(rowIndex, 13).setValue(now);
    }

    Logger.log('[updateInvoiceStatus] ì²­êµ¬ì„œ ìƒíƒœ ì—…ë°ì´íŠ¸: ' + invoiceId + ' -> ' + status);

    return {
      success: true,
      message: 'ì²­êµ¬ì„œ ìƒíƒœê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.'
    };

  } catch (err) {
    Logger.log('[updateInvoiceStatus Error] ' + err.message);
    return {
      success: false,
      error: 'ìƒíƒœ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + err.message
    };
  }
}

/**
 * ì²­êµ¬ì„œ ì¬ì¶œë ¥ (PDF ì¬ìƒì„±)
 * @param {Object} params - { invoiceId, billingId }
 * @returns {Object} ì¬ì¶œë ¥ ê²°ê³¼
 */
function reprintInvoice(params) {
  try {
    var invoiceId = (params && (params.invoiceId || params.billingId)) || '';

    if (!invoiceId) {
      return {
        success: false,
        error: 'ì²­êµ¬IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'
      };
    }

    var ss = SpreadsheetApp.openById(OB_INVOICE_SS_ID);
    var sheet = ss.getSheetByName(OB_INVOICE_SHEET);

    if (!sheet) {
      return {
        success: false,
        error: 'ì²­êµ¬DB ì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'
      };
    }

    var data = sheet.getDataRange().getValues();
    var row = null;

    for (var i = 1; i < data.length; i++) {
      if (data[i][0] === invoiceId) {
        row = data[i];
        break;
      }
    }

    if (!row) {
      return {
        success: false,
        error: 'í•´ë‹¹ ì²­êµ¬ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'
      };
    }

    var type = row[1] || (params.type || '');
    var company = row[2] || '';
    var settlementId = row[3] || params.settlementId || '';

    if (!settlementId) {
      return {
        success: false,
        error: 'ì—°ê²°ëœ ë§ˆê°IDê°€ ì—†ì–´ ì¬ì¶œë ¥ì„ ì§„í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'
      };
    }

    var detailResult = getSettlementDetail({
      settlementId: settlementId,
      type: type
    });

    if (!detailResult || !detailResult.success) {
      return {
        success: false,
        error: detailResult && detailResult.error ? detailResult.error : 'ë§ˆê° ìƒì„¸ ì¡°íšŒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'
      };
    }

    var items = detailResult.items || [];
    var orderCodes = items
      .map(function(item) { return item.orderCode; })
      .filter(function(code) { return !!code; });

    if (!orderCodes.length) {
      return {
        success: false,
        error: 'ì¬ì¶œë ¥í•  ë°œì£¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'
      };
    }

    var modesByOrder = {};
    orderCodes.forEach(function(code) { modesByOrder[code] = 'auto'; });

    var zipResult = generateInvoiceZip({
      orderCodes: orderCodes,
      docType: 'INVOICE_VAT',
      printMode: 'auto',
      modesByOrder: modesByOrder,
      mergeBySupplier: false
    });

    if (!zipResult || !zipResult.success) {
      return {
        success: false,
        error: zipResult && zipResult.error ? zipResult.error : 'PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'
      };
    }

    return {
      success: true,
      fileId: zipResult.fileId,
      fileName: zipResult.fileName,
      settlement: detailResult.settlement,
      orderCount: orderCodes.length
    };

  } catch (err) {
    Logger.log('[reprintInvoice Error] ' + err.message);
    return {
      success: false,
      error: 'ì¬ì¶œë ¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + err.message
    };
  }
}

/**
 * ============================================================
 * 5. ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
 * ============================================================
 */

/**
 * ë‚ ì§œ í¬ë§· í•¨ìˆ˜
 */
function formatDateString(date) {
  if (!date) return '';
  if (typeof date === 'string') return date;

  var d = new Date(date);
  if (isNaN(d.getTime())) return '';

  var year = d.getFullYear();
  var month = String(d.getMonth() + 1).padStart(2, '0');
  var day = String(d.getDate()).padStart(2, '0');

  return year + '-' + month + '-' + day;
}

/**
 * ë…„ì›” í¬ë§· í•¨ìˆ˜ (YYYYMM)
Layout.html
+105
-0

<!DOCTYPE html>
<html>
  <head>
    <?!= include('CommonHead'); ?>
  </head>
  <body class="ob-body">
    <div class="ob-app-shell">
      <!-- ì¢Œì¸¡ ì‚¬ì´ë“œë°” -->
      <aside class="ob-sidebar">
        <?!= include('Component_Sidebar'); ?>
      </aside>

      <!-- ìš°ì¸¡ ë©”ì¸ ì˜ì—­ -->
      <main class="ob-main">
        <header class="ob-header">
          <?!= include('Component_HeaderNav'); ?>
        </header>

        <section id="app-main" class="ob-main-content">
          <? if (page === 'dashboard') { ?>
            <?!= include('Page_Dashboard'); ?>
          <? } else if (page === 'orderList') { ?>
            <?!= include('Page_OrderList'); ?>
          <? } else if (page === 'invoiceOutput') { ?>
            <?!= include('Page_InvoiceOutput'); ?>
          <? } else if (page === 'transactionLedger') { ?>
            <?!= include('Page_TransactionLedger'); ?>
          <? } else if (page === 'purchaseSettlement') { ?>
            <?!= include('Page_PurchaseSettlement'); ?>
          <? } else if (page === 'salesSettlement') { ?>
            <?!= include('Page_SalesSettlement'); ?>
          <? } else if (page === 'monthlyClosing') { ?>
            <?!= include('Page_MonthlyClosing'); ?>
          <? } else if (page === 'billingManagement') { ?>
            <?!= include('Page_BillingManagement'); ?>
          <? } else if (page === 'invoiceManagement') { ?>
            <?!= include('Page_InvoiceManagement'); ?>
          <? } else if (page === 'settings') { ?>
            <?!= include('Page_Settings'); ?>
          <? } else { ?>
            <?!= include('Page_OrderFile'); ?>
          <? } ?>
        </section>
      </main>
    </div>

    <!-- ë§ˆê° ìƒì„¸ ëª¨ë‹¬ (ê³µìš©) -->
    <style>
      .settlement-detail-modal { position:fixed; inset:0; background:rgba(0,0,0,0.45); display:none; align-items:center; justify-content:center; z-index:9999; }
      .settlement-detail-modal.active { display:flex; }
      .settlement-detail-card { background:#fff; border-radius:12px; width:95%; max-width:1100px; max-height:90vh; overflow:hidden; box-shadow:0 8px 30px rgba(0,0,0,0.25); display:flex; flex-direction:column; }
      .settlement-detail-header { padding:20px; border-bottom:1px solid #e2e8f0; display:flex; justify-content:space-between; align-items:center; }
      .settlement-detail-title { margin:0; font-size:18px; font-weight:700; color:#0f172a; }
      .settlement-detail-close { background:none; border:none; font-size:24px; cursor:pointer; color:#64748b; }
      .settlement-detail-body { padding:20px; overflow:auto; }
      .settlement-detail-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(180px, 1fr)); gap:12px; margin-bottom:16px; }
      .settlement-detail-item { background:#f8fafc; border:1px solid #e2e8f0; border-radius:8px; padding:12px; }
      .settlement-detail-label { font-size:12px; color:#64748b; margin-bottom:4px; }
      .settlement-detail-value { font-size:14px; font-weight:600; color:#0f172a; }
      .settlement-detail-table-wrap { border:1px solid #e2e8f0; border-radius:8px; overflow:auto; max-height:420px; }
      .settlement-detail-table { width:100%; border-collapse:collapse; font-size:13px; }
      .settlement-detail-table th, .settlement-detail-table td { padding:10px; border-bottom:1px solid #e2e8f0; text-align:left; }
      .settlement-detail-table th { background:#f1f5f9; position:sticky; top:0; z-index:1; }
      .settlement-detail-table td.num { text-align:right; }
      .settlement-detail-empty { text-align:center; padding:40px 10px; color:#64748b; }
    </style>

    <div id="settlement-detail-modal" class="settlement-detail-modal">
      <div class="settlement-detail-card">
        <div class="settlement-detail-header">
          <h2 class="settlement-detail-title" id="settlement-detail-title">ë§ˆê° ìƒì„¸</h2>
          <button id="settlement-detail-close" class="settlement-detail-close">Ã—</button>
        </div>
        <div class="settlement-detail-body">
          <div class="settlement-detail-grid">
            <div class="settlement-detail-item">
              <div class="settlement-detail-label">ë§ˆê° ID</div>
              <div class="settlement-detail-value" id="settlement-detail-id">-</div>
            </div>
            <div class="settlement-detail-item">
              <div class="settlement-detail-label">ë§ˆê° ìœ í˜•</div>
              <div class="settlement-detail-value" id="settlement-detail-type">-</div>
            </div>
            <div class="settlement-detail-item">
              <div class="settlement-detail-label">ê±°ë˜ì²˜</div>
              <div class="settlement-detail-value" id="settlement-detail-partner">-</div>
            </div>
            <div class="settlement-detail-item">
              <div class="settlement-detail-label">ê¸°ê°„</div>
              <div class="settlement-detail-value" id="settlement-detail-period">-</div>
            </div>
            <div class="settlement-detail-item">
              <div class="settlement-detail-label">ìƒíƒœ</div>
              <div class="settlement-detail-value" id="settlement-detail-status">-</div>
            </div>
            <div class="settlement-detail-item">
              <div class="settlement-detail-label">ì´ í’ˆëª©ìˆ˜</div>
              <div class="settlement-detail-value" id="settlement-detail-items">0</div>
            </div>
            <div class="settlement-detail-item">
              <div class="settlement-detail-label">ì´ ë°œì£¼ìˆ˜ëŸ‰</div>
              <div class="settlement-detail-value" id="settlement-detail-order-qty">0</div>
            </div>
            <div class="settlement-detail-item">
              <div class="settlement-detail-label">ì´ í™•ì •ìˆ˜ëŸ‰</div>
              <div class="settlement-detail-value" id="settlement-detail-confirmed-qty">0</div>
            </div>
            <div class="settlement-detail-item">
              <div class="settlement-detail-label">ì´ ê¸ˆì•¡</div>
              <div class="settlement-detail-value" id="settlement-detail-amount">â‚©0</div>
            </div>
          </div>

          <div class="settlement-detail-table-wrap">
            <table class="settlement-detail-table">
              <thead>
                <tr>
                  <th>ë°œì£¼ë²ˆí˜¸</th>
                  <th>ë°œì£¼ì¼</th>
                  <th>ê±°ë˜ì²˜</th>
                  <th>ë¸Œëœë“œ</th>
                  <th>ì œí’ˆëª…</th>
                  <th>í’ˆëª©ì½”ë“œ</th>
                  <th class="num">ë°œì£¼ìˆ˜ëŸ‰</th>
                  <th class="num">í™•ì •ìˆ˜ëŸ‰</th>
                  <th class="num">ì°¨ì´</th>
                  <th class="num" id="settlement-detail-price-label">ë‹¨ê°€</th>
                  <th class="num" id="settlement-detail-amount-label">ê¸ˆì•¡</th>
                </tr>
              </thead>
              <tbody id="settlement-detail-tbody">
                <tr><td colspan="11" class="settlement-detail-empty">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <?!= include('CommonScripts'); ?>
  </body>
</html>
OneBridge_ERP_Architecture_v2.2.md
+12
-10

@@ -828,70 +828,72 @@ YYYYMMDD-ê±°ë˜ì²˜ì½”ë“œ-ë¸Œëœë“œì½”ë“œ-SEQ

3. **ë§ˆê° ë‚´ì—­ ì¡°íšŒ ê¸°ëŠ¥** (CommonScripts.html)
   ```javascript
   // íƒ­ ì „í™˜ ê¸°ëŠ¥
   tabs.forEach(function(tab) {
     tab.addEventListener('click', function() {
       // íƒ­ ì „í™˜ ë¡œì§
     });
   });

   // ë§ˆê° ë‚´ì—­ ì¡°íšŒ
   google.script.run
     .withSuccessHandler(renderHistoryTable)
     .getPurchaseSettlementsApi({ type: 'PURCHASE' });
   ```

**ì˜í–¥ íŒŒì¼**:
- CommonScripts.html (ê²€ìƒ‰ì¡°ê±´ ë³€ê²½, íƒ­ ê¸°ëŠ¥, ë§ˆê° ë‚´ì—­ ì¡°íšŒ)
- Page_PurchaseSettlement.html (íƒ­ UI, CSS ì¶”ê°€)
- Page_SalesSettlement.html (íƒ­ UI, CSS ì¶”ê°€)

**ê´€ë ¨ ì»¤ë°‹**: `be9dd10`

---

## 6.2 ì•Œë ¤ì§„ ì´ìŠˆ (ë¯¸í•´ê²°)
## 6.2 ì•Œë ¤ì§„ ì´ìŠˆ (2025-12-06 ê¸°ì¤€)

| ID | ì´ìŠˆ | ìš°ì„ ìˆœìœ„ | ìƒíƒœ |
|----|------|----------|------|
| #005 | Page_OrderFile.htmlì— `<script>` íƒœê·¸ ì¡´ì¬ | ë‚®ìŒ | ë³´ë¥˜ (SSRì—ì„œë§Œ ì‚¬ìš©) |
| #006 | getCustomers() í•¨ìˆ˜ ì¤‘ë³µ ì •ì˜ | ì¤‘ê°„ | ê²€í†  í•„ìš” |
| #007 | ping() í•¨ìˆ˜ Date ê°ì²´ ë°˜í™˜ | ë‚®ìŒ | ìˆ˜ì • í•„ìš” |
| #008 | ì²­êµ¬ì„œ ì¬ì¶œë ¥ ê¸°ëŠ¥ ë¯¸êµ¬í˜„ | ì¤‘ê°„ | êµ¬í˜„ í•„ìš” |
| #009 | getInvoicesApi, aggregateInvoiceDataApi UI ë¯¸ì—°ê²° | ë‚®ìŒ | í•„ìš”ì‹œ êµ¬í˜„ |
| #010 | getTransactionsApi, updateTransactionStateApi UI ë¯¸ì—°ê²° | ë‚®ìŒ | í•„ìš”ì‹œ êµ¬í˜„ |
| #011 | ë§ˆê° ìƒì„¸ë³´ê¸° ê¸°ëŠ¥ (OB.viewSettlementDetail) ë¯¸êµ¬í˜„ | ì¤‘ê°„ | êµ¬í˜„ í•„ìš” |
| #005 | Page_OrderFile.htmlì— `<script>` íƒœê·¸ ì¡´ì¬ | ë‚®ìŒ | âœ… `CommonScripts.html`ë¡œ ì´ë™ ì™„ë£Œ |
| #006 | getCustomers() í•¨ìˆ˜ ì¤‘ë³µ ì •ì˜ | ì¤‘ê°„ | âœ… `ApiService.js`ë¡œ ì¼ì›í™” ì™„ë£Œ |
| #007 | ping() í•¨ìˆ˜ Date ê°ì²´ ë°˜í™˜ | ë‚®ìŒ | âœ… ISO ë¬¸ìì—´ ë°˜í™˜ìœ¼ë¡œ ìˆ˜ì • ì™„ë£Œ |
| #008 | ì²­êµ¬ì„œ ì¬ì¶œë ¥ ê¸°ëŠ¥ ë¯¸êµ¬í˜„ | ì¤‘ê°„ | âœ… `reprintInvoiceApi`/í´ë¼ì´ì–¸íŠ¸ ì—°ë™ ì™„ë£Œ |
| #009 | getInvoicesApi, aggregateInvoiceDataApi UI ë¯¸ì—°ê²° | ë‚®ìŒ | âœ… ì¸ë³´ì´ìŠ¤ ê´€ë¦¬ í˜ì´ì§€ì—ì„œ í˜¸ì¶œ |
| #010 | getTransactionsApi, updateTransactionStateApi UI ë¯¸ì—°ê²° | ë‚®ìŒ | âœ… ê±°ë˜ì›ì¥ í˜ì´ì§€ì—ì„œ í˜¸ì¶œ |
| #011 | ë§ˆê° ìƒì„¸ë³´ê¸° ê¸°ëŠ¥ (OB.viewSettlementDetail) ë¯¸êµ¬í˜„ | ì¤‘ê°„ | âœ… ëª¨ë‹¬ ìƒì„¸ë³´ê¸° êµ¬í˜„ ì™„ë£Œ |

> í˜„ì¬ ê¸°ì¤€ìœ¼ë¡œ ì‹ ê·œ ë¯¸í•´ê²° ì´ìŠˆëŠ” ì—†ìœ¼ë©°, v2.3 í‘œì¤€í™” ì‘ì—…(ëª…ëª… ê·œì¹™Â·ì—ëŸ¬ ì²˜ë¦¬ ì¼ê´€í™”)ë§Œ ë‚¨ì•„ ìˆë‹¤.

---

# PART 7: FUTURE ROADMAP

## 7.1 ë‹¨ê¸° ê³„íš (v2.3)

- [ ] ëª¨ë“  API í•¨ìˆ˜ì— safeReturn() ì ìš© í™•ì¸
- [ ] Page_OrderFile.html ìŠ¤í¬ë¦½íŠ¸ CommonScriptsë¡œ ì´ë™
- [x] ëª¨ë“  API í•¨ìˆ˜ì— safeReturn() ì ìš© í™•ì¸ (ApiService ë˜í¼ ê¸°ì¤€ ì¬ì ê²€ ì™„ë£Œ)
- [x] Page_OrderFile.html ìŠ¤í¬ë¦½íŠ¸ CommonScriptsë¡œ ì´ë™
- [ ] í•¨ìˆ˜ ëª…ëª… ê·œì¹™ í†µì¼
- [ ] ì—ëŸ¬ ì²˜ë¦¬ í‘œì¤€í™”

## 7.2 ì¤‘ê¸° ê³„íš (v3.0)

- [ ] Utils.gs ê³µí†µ ìœ í‹¸ë¦¬í‹° ë¶„ë¦¬
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ë„ì…
- [ ] ì½”ë“œ ë¬¸ì„œí™” (JSDoc)
- [ ] Page_Settings ê¸°ëŠ¥ êµ¬í˜„
- [ ] ë§ˆê°/ì²­êµ¬ì„œ ê¸°ëŠ¥ ê³ ë„í™”

## 7.3 ì¥ê¸° ê³„íš

- [ ] Supabase/MySQL ë°ì´í„° ì´ê´€
- [ ] Full SPA ì „í™˜ (React/Vue)
- [ ] í™•ì •ìˆ˜ëŸ‰ íšŒì‹  í¬í„¸
- [ ] ìë™ ë§¤ì…ê²°ì œ ìŠ¤ì¼€ì¤„ë§
- [ ] AI ê¸°ë°˜ ë°œì£¼ ì˜ˆì¸¡

---

# PART 8: APPENDIX

## A. JSON ì§ë ¬í™” ë¶ˆê°€ ë°ì´í„° íƒ€ì…

OrderParsingService.js
+0
-89

@@ -646,139 +646,50 @@ function detectOrderFileColumns_(header) {
    packQty:       findIndex(['ì…ìˆ˜ëŸ‰', 'ì…ìˆ˜']),
    consumerPrice: findIndex(['ì†Œë¹„ìê°€', 'ì†Œë¹„ìê°€ê²©']),
    supplyPrice:   findIndex(['ê³µê¸‰ê°€(VATí¬í•¨)', 'ê³µê¸‰ê°€ (VATí¬í•¨)', 'ê³µê¸‰ê°€', 'ê³µê¸‰ë‹¨ê°€']),
    orderQty:      findIndex(['ë°œì£¼ìˆ˜ëŸ‰', 'ìˆ˜ëŸ‰', 'ì£¼ë¬¸ìˆ˜ëŸ‰']),
    orderAmount:   findIndex(['ë°œì£¼ê¸ˆì•¡', 'í•©ê³„', 'ê³µê¸‰ê°€í•©ê³„', 'ì£¼ë¬¸ê¸ˆì•¡', 'ê¸ˆì•¡']),
    inboundPlace:  findIndex(['ì…ê³ ì§€', 'ì…ê³ ì²˜', 'ë‚©í’ˆì²˜'])
  };
}

/* ============================================================
 * Helper
 * ============================================================ */

function safeCell_(v) {
  if (v === null || v === undefined) return '';
  return String(v).trim();
}

function toNumber_(v) {
  if (v === null || v === undefined || v === '') return 0;
  var s = typeof v === 'string' ? v.replace(/,/g, '') : v;
  var n = Number(s);
  return isNaN(n) ? 0 : n;
}

/**
 * ë°œì£¼ì²˜(ê±°ë˜ì²˜) ëª©ë¡ ì¡°íšŒ
 * ê±°ë˜ì²˜DBì—ì„œ 'ì£¼ê±°ë˜ì²˜' ì»¬ëŸ¼ì´ 'ë°œì£¼ì²˜'ì¸ ê±°ë˜ì²˜ë§Œ ë°˜í™˜
 * @returns {Object} {success: boolean, data: Array<string>, error: string}
 */
function getCustomers() {
  try {
    var ss = SpreadsheetApp.openById(OB_MASTER_DB_SS_ID);
    var sheet = ss.getSheetByName('ê±°ë˜ì²˜DB');
    
    if (!sheet) {
      Logger.log('[getCustomers] âš ï¸ ê±°ë˜ì²˜DB ì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      return {
        success: false,
        error: 'ê±°ë˜ì²˜DB ì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
        data: []
      };
    }
    
    var data = sheet.getDataRange().getValues();
    if (data.length <= 1) {
      return {
        success: true,
        data: [],
        error: ''
      };
    }
    
    var header = data[0];
    
    // ì»¬ëŸ¼ ì¸ë±ìŠ¤ ì°¾ê¸°
    var nameIdx = header.indexOf('ê±°ë˜ì²˜ëª…');      // Bì—´
    var mainTypeIdx = header.indexOf('ì£¼ê±°ë˜ì²˜');   // Jì—´
    
    if (nameIdx < 0) {
      Logger.log('[getCustomers] âš ï¸ ê±°ë˜ì²˜ëª… ì»¬ëŸ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      return {
        success: false,
        error: 'ê±°ë˜ì²˜ëª… ì»¬ëŸ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
        data: []
      };
    }
    
    var customers = [];
    var seen = {}; // ì¤‘ë³µ ì œê±°ìš©
    
    for (var i = 1; i < data.length; i++) {
      var row = data[i];
      var name = safeCell_(row[nameIdx]);
      
      // ì£¼ê±°ë˜ì²˜ ì»¬ëŸ¼ì´ ìˆëŠ” ê²½ìš°
      if (mainTypeIdx >= 0) {
        var mainType = safeCell_(row[mainTypeIdx]);
        
        // 'ë°œì£¼ì²˜'ê°€ í¬í•¨ëœ ê±°ë˜ì²˜ë§Œ ì„ íƒ
        if (mainType && mainType.indexOf('ë°œì£¼ì²˜') >= 0) {
          if (name && !seen[name]) {
            customers.push(name);
            seen[name] = true;
          }
        }
      } else {
        // ì£¼ê±°ë˜ì²˜ ì»¬ëŸ¼ì´ ì—†ìœ¼ë©´ ëª¨ë“  ê±°ë˜ì²˜ ë°˜í™˜
        if (name && !seen[name]) {
          customers.push(name);
          seen[name] = true;
        }
      }
    }
    
    Logger.log('[getCustomers] ë°œì£¼ì²˜ ëª©ë¡: ' + JSON.stringify(customers));
    Logger.log('[getCustomers] ì´ ' + customers.length + 'ê°œ');
    
    return {
      success: true,
      data: customers.sort(), // ê°€ë‚˜ë‹¤ìˆœ ì •ë ¬
      error: ''
    };
    
  } catch (e) {
    Logger.log('[getCustomers Error] ' + e.toString());
    return {
      success: false,
      error: e.toString(),
      data: []
    };
  }
}

/**
 * âœ… í’ˆëª©DBì—ì„œ ë°”ì½”ë“œë¡œ ë§¤ì…ê°€ ì¡°íšŒ
 */
function getBuyPriceFromProductDB_(barcode) {
  var ss = SpreadsheetApp.openById(OB_MASTER_DB_SS_ID);
  var sheet = ss.getSheetByName(OB_MASTER_PRODUCT_SHEET);
  
  if (!sheet) {
    Logger.log('âš ï¸ í’ˆëª©DB ì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    return 0;
  }

  var data = sheet.getDataRange().getValues();
  if (data.length === 0) return 0;

  var header = data[0];
  var barcodeIdx = header.indexOf('ë°”ì½”ë“œ');
  var buyPriceIdx = header.indexOf('ë§¤ì…ê°€');

  if (barcodeIdx < 0 || buyPriceIdx < 0) {
    Logger.log('âš ï¸ í’ˆëª©DBì—ì„œ ë°”ì½”ë“œ ë˜ëŠ” ë§¤ì…ê°€ ì»¬ëŸ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    return 0;
  }

  // ë°”ì½”ë“œ ë¬¸ìì—´ ì •ê·œí™”
Page_InvoiceManagement.html
ì‹ ê·œ
+202
-0

<style>
  .invoice-wrap { padding: 20px; }
  .invoice-header { margin-bottom: 16px; }
  .invoice-header h1 { margin: 0 0 6px; font-size: 22px; font-weight: 700; color: #111827; }
  .invoice-header p { margin: 0; color: #6b7280; font-size: 13px; }

  .invoice-panel { background: #fff; border-radius: 10px; box-shadow: 0 1px 4px rgba(0,0,0,0.1); padding: 14px; margin-bottom: 14px; }
  .invoice-panel h2 { margin: 0 0 10px; font-size: 16px; color: #0f172a; }
  .invoice-flex { display: flex; flex-wrap: wrap; gap: 12px; align-items: flex-end; }
  .invoice-field { display: flex; flex-direction: column; gap: 4px; }
  .invoice-field label { font-size: 12px; font-weight: 600; color: #475569; }
  .invoice-field input, .invoice-field select { padding: 8px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 13px; min-width: 160px; }
  .invoice-btn { padding: 8px 14px; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 600; }
  .invoice-btn.primary { background: #2563eb; color: #fff; }
  .invoice-btn.secondary { background: #e5e7eb; color: #1f2937; }
  .invoice-btn.success { background: #10b981; color: #fff; }
  .invoice-btn.primary:hover { background: #1d4ed8; }
  .invoice-btn.secondary:hover { background: #d1d5db; }
  .invoice-btn.success:hover { background: #059669; }

  .invoice-summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px; margin-top: 12px; }
  .invoice-summary-card { background: #f8fafc; border: 1px solid #e2e8f0; padding: 12px; border-radius: 8px; }
  .invoice-summary-label { font-size: 12px; color: #6b7280; margin-bottom: 4px; }
  .invoice-summary-value { font-size: 18px; font-weight: 700; color: #0f172a; }

  .invoice-table-wrap { background: #fff; border-radius: 8px; box-shadow: 0 1px 4px rgba(0,0,0,0.1); overflow: auto; max-height: 640px; }
  .invoice-table { width: 100%; border-collapse: collapse; font-size: 13px; }
  .invoice-table th, .invoice-table td { padding: 10px; border-bottom: 1px solid #e5e7eb; text-align: left; }
  .invoice-table th { background: #f8fafc; position: sticky; top: 0; z-index: 1; font-weight: 700; }
  .invoice-table td.num { text-align: right; }
  .invoice-badge { display: inline-block; padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: 700; background: #e5e7eb; color: #374151; }
  .invoice-empty { text-align: center; padding: 40px 12px; color: #94a3b8; }
</style>

<div class="invoice-wrap">
  <div class="invoice-header">
    <h1>ì¸ë³´ì´ìŠ¤ ê´€ë¦¬</h1>
    <p>ì²­êµ¬ ë°ì´í„° ì§‘ê³„, ì¸ë³´ì´ìŠ¤ ìƒì„± ë° ìƒíƒœ ê´€ë¦¬ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p>
  </div>

  <div class="invoice-panel">
    <h2>1) ì²­êµ¬ ë°ì´í„° ì§‘ê³„</h2>
    <div class="invoice-flex">
      <div class="invoice-field">
        <label for="invoice-agg-company">ê±°ë˜ì²˜</label>
        <input type="text" id="invoice-agg-company" placeholder="ê±°ë˜ì²˜ëª…ì„ ì…ë ¥" />
      </div>
      <div class="invoice-field">
        <label for="invoice-agg-start">ì‹œì‘ì¼</label>
        <input type="date" id="invoice-agg-start" />
      </div>
      <div class="invoice-field">
        <label for="invoice-agg-end">ì¢…ë£Œì¼</label>
        <input type="date" id="invoice-agg-end" />
      </div>
      <button class="invoice-btn primary" id="invoice-agg-btn">ì§‘ê³„ ì‹¤í–‰</button>
    </div>

    <div class="invoice-summary" id="invoice-agg-summary" style="display:none;">
      <div class="invoice-summary-card">
        <div class="invoice-summary-label">ì´ í’ˆëª©ìˆ˜</div>
        <div class="invoice-summary-value" id="invoice-agg-items">0</div>
      </div>
      <div class="invoice-summary-card">
        <div class="invoice-summary-label">ë°œì£¼ìˆ˜ëŸ‰ í•©ê³„</div>
        <div class="invoice-summary-value" id="invoice-agg-order-qty">0</div>
      </div>
      <div class="invoice-summary-card">
        <div class="invoice-summary-label">í™•ì •ìˆ˜ëŸ‰ í•©ê³„</div>
        <div class="invoice-summary-value" id="invoice-agg-confirmed-qty">0</div>
      </div>
      <div class="invoice-summary-card">
        <div class="invoice-summary-label">ê³µê¸‰ì•¡ í•©ê³„</div>
        <div class="invoice-summary-value" id="invoice-agg-amount">â‚©0</div>
      </div>
    </div>

    <div class="invoice-table-wrap" style="margin-top:10px; display:none;" id="invoice-agg-table-wrap">
      <table class="invoice-table">
        <thead>
          <tr>
            <th>ë°œì£¼ì¼</th>
            <th>ë°œì£¼ë²ˆí˜¸</th>
            <th>ë§¤ì…ì²˜</th>
            <th>ë¸Œëœë“œ</th>
            <th>ì œí’ˆëª…</th>
            <th class="num">í™•ì •ìˆ˜ëŸ‰</th>
            <th class="num">ê³µê¸‰ê°€</th>
            <th class="num">ê³µê¸‰ì•¡</th>
          </tr>
        </thead>
        <tbody id="invoice-agg-tbody">
          <tr><td colspan="8" class="invoice-empty">ì§‘ê³„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="invoice-panel">
    <h2>2) Settlement ê¸°ë°˜ ì¸ë³´ì´ìŠ¤ ìƒì„±</h2>
    <div class="invoice-flex">
      <div class="invoice-field">
        <label for="invoice-create-settlement">ë§ˆê° ID</label>
        <input type="text" id="invoice-create-settlement" placeholder="ì˜ˆ) SET-202501-001" />
      </div>
      <div class="invoice-field">
        <label for="invoice-create-type">ìœ í˜•</label>
        <select id="invoice-create-type">
          <option value="">ì„ íƒí•˜ì„¸ìš”</option>
          <option value="PURCHASE">ë§¤ì…</option>
          <option value="SALES">ë§¤ì¶œ</option>
        </select>
      </div>
      <div class="invoice-field">
        <label for="invoice-create-company">ê±°ë˜ì²˜</label>
        <input type="text" id="invoice-create-company" placeholder="ì§‘ê³„ëœ ê±°ë˜ì²˜ì™€ ë™ì¼í•˜ê²Œ ì…ë ¥" />
      </div>
      <div class="invoice-field">
        <label for="invoice-create-date">ì²­êµ¬ì¼</label>
        <input type="date" id="invoice-create-date" />
      </div>
      <div class="invoice-field">
        <label for="invoice-create-amount">ì²­êµ¬ê¸ˆì•¡</label>
        <input type="number" id="invoice-create-amount" min="0" />
      </div>
      <div class="invoice-field" style="flex:1; min-width:200px;">
        <label for="invoice-create-notes">ë¹„ê³ </label>
        <input type="text" id="invoice-create-notes" placeholder="ì„ íƒì‚¬í•­" />
      </div>
      <button class="invoice-btn success" id="invoice-create-btn">ì²­êµ¬ì„œ ìƒì„±</button>
    </div>
  </div>

  <div class="invoice-panel">
    <h2>3) ì¸ë³´ì´ìŠ¤ ëª©ë¡</h2>
    <div class="invoice-flex">
      <div class="invoice-field">
        <label for="invoice-filter-type">ìœ í˜•</label>
        <select id="invoice-filter-type">
          <option value="">ì „ì²´</option>
          <option value="PURCHASE">ë§¤ì…</option>
          <option value="SALES">ë§¤ì¶œ</option>
        </select>
      </div>
      <div class="invoice-field">
        <label for="invoice-filter-company">ê±°ë˜ì²˜</label>
        <input type="text" id="invoice-filter-company" placeholder="ê±°ë˜ì²˜ëª…" />
      </div>
      <div class="invoice-field">
        <label for="invoice-filter-status">ìƒíƒœ</label>
        <select id="invoice-filter-status">
          <option value="">ì „ì²´</option>
          <option value="DRAFT">DRAFT</option>
          <option value="ISSUED">ISSUED</option>
          <option value="PAID">PAID</option>
        </select>
      </div>
      <div class="invoice-field">
        <label for="invoice-filter-start">ì‹œì‘ì¼</label>
        <input type="date" id="invoice-filter-start" />
      </div>
      <div class="invoice-field">
        <label for="invoice-filter-end">ì¢…ë£Œì¼</label>
        <input type="date" id="invoice-filter-end" />
      </div>
      <button class="invoice-btn primary" id="invoice-search-btn">ì¡°íšŒ</button>
      <button class="invoice-btn secondary" id="invoice-reset-btn">ì´ˆê¸°í™”</button>
    </div>

    <div class="invoice-summary" style="margin-top:10px;" id="invoice-list-summary">
      <div class="invoice-summary-card">
        <div class="invoice-summary-label">ì´ ì²­êµ¬ê±´ìˆ˜</div>
        <div class="invoice-summary-value" id="invoice-list-count">0ê±´</div>
      </div>
      <div class="invoice-summary-card">
        <div class="invoice-summary-label">ì´ ì²­êµ¬ê¸ˆì•¡</div>
        <div class="invoice-summary-value" id="invoice-list-amount">â‚©0</div>
      </div>
    </div>

    <div class="invoice-table-wrap" style="margin-top:10px;">
      <table class="invoice-table">
        <thead>
          <tr>
            <th>ì²­êµ¬ID</th>
            <th>ìœ í˜•</th>
            <th>ê±°ë˜ì²˜</th>
            <th>ë§ˆê°ID</th>
            <th>ì²­êµ¬ì¼</th>
            <th class="num">ì²­êµ¬ê¸ˆì•¡</th>
            <th>ìƒíƒœ</th>
            <th>ë¹„ê³ </th>
            <th>ì•¡ì…˜</th>
          </tr>
        </thead>
        <tbody id="invoice-list-tbody">
          <tr><td colspan="9" class="invoice-empty">ì¡°íšŒëœ ì¸ë³´ì´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
Page_OrderFile.html
+0
-464

@@ -347,489 +347,25 @@
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- ì¤‘ë³µ ë°œì£¼ ê²½ê³  ëª¨ë‹¬ -->
<div id="ob-duplicate-modal" class="ob-modal-overlay">
  <div class="ob-modal">
    <div class="ob-modal-header">
      <div class="ob-modal-icon">âš ï¸</div>
      <div class="ob-modal-title">ì¤‘ë³µ ë°œì£¼ ê²½ê³ </div>
    </div>
    <div class="ob-modal-body">
      <p>ì˜¤ëŠ˜ ì´ë¯¸ ì„ íƒí•œ ë°œì£¼ì²˜ì— ë°œì£¼ ë‚´ì—­ì´ ìˆìŠµë‹ˆë‹¤:</p>
      <div id="duplicate-order-list" class="ob-modal-list"></div>
      <p style="margin-top: 12px;">ê³„ì† ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
    </div>
    <div class="ob-modal-footer">
      <button type="button" id="ob-btn-duplicate-cancel" class="ob-btn">ì·¨ì†Œ</button>
      <button type="button" id="ob-btn-duplicate-continue" class="ob-btn ob-btn-success">ê³„ì† ì§„í–‰</button>
    </div>
  </div>
</div>

<script>
  window.OB = window.OB || {};
  
  OB.initOrderFilePage = function() {
    var wrap = document.getElementById('ob-orderfile-wrap');
    if (!wrap) {
      console.warn('OrderFile wrapper not found');
      return;
    }

    if (wrap.dataset.bound === '1') {
      console.log('OrderFile already initialized');
      return;
    }
    wrap.dataset.bound = '1';
    
    console.log('âœ… OrderFile Page ì´ˆê¸°í™” ì™„ë£Œ');

    var parsedItems = [];
    var currentFilter = 'all'; // 'all' or 'unmatched'
    
    var customerSelect = document.getElementById('ob-customer-select');
    var fileInput = document.getElementById('ob-orderfile-input');
    var btnParse = document.getElementById('ob-btn-parse');
    var btnSave = document.getElementById('ob-btn-save');
    var tableBody = document.querySelector('#ob-orderfile-table tbody');
    
    var summaryCards = document.getElementById('ob-summary-cards');
    var summaryTotal = document.getElementById('summary-total');
    var summaryMatched = document.getElementById('summary-matched');
    var summaryUnmatched = document.getElementById('summary-unmatched');
    var summaryAmount = document.getElementById('summary-amount');
    var summaryMatchCard = document.getElementById('summary-match-card');
    
    var filterControls = document.getElementById('ob-filter-controls');
    var btnFilterUnmatched = document.getElementById('ob-btn-filter-unmatched');
    var btnFilterAll = document.getElementById('ob-btn-filter-all');
    
    var duplicateModal = document.getElementById('ob-duplicate-modal');
    var duplicateOrderList = document.getElementById('duplicate-order-list');
    var btnDuplicateCancel = document.getElementById('ob-btn-duplicate-cancel');
    var btnDuplicateContinue = document.getElementById('ob-btn-duplicate-continue');

    // ë°œì£¼ì²˜ ëª©ë¡ ë¡œë“œ
    loadCustomers();

    function loadCustomers() {
      console.log('ğŸ“„ ë°œì£¼ì²˜ ëª©ë¡ ë¡œë“œ ì¤‘...');
      
      google.script.run
        .withSuccessHandler(function(result) {
          console.log('âœ… ë°œì£¼ì²˜ ì‘ë‹µ:', result);
          
          if (result && result.success && result.data && Array.isArray(result.data)) {
            console.log('ğŸ“‹ ë°œì£¼ì²˜ ê°œìˆ˜:', result.data.length);
            
            result.data.forEach(function(customerName) {
              var option = document.createElement('option');
              option.value = customerName;
              option.textContent = customerName;
              customerSelect.appendChild(option);
            });
            
            console.log('âœ… ë°œì£¼ì²˜ ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸° ì™„ë£Œ');
          } else {
            console.warn('âš ï¸ ë°œì£¼ì²˜ ë°ì´í„° í˜•ì‹ ì˜¤ë¥˜:', result);
          }
        })
        .withFailureHandler(function(error) {
          console.error('âŒ ë°œì£¼ì²˜ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
          alert('ë°œì£¼ì²˜ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message);
        })
        .getCustomers();
    }

    /**
     * íŒŒì‹± ë²„íŠ¼ í´ë¦­
     */
    if (btnParse) {
      btnParse.addEventListener('click', function() {
        var file = fileInput.files[0];
        var selectedCustomer = customerSelect.value;
        
        if (!selectedCustomer) {
          alert('ë°œì£¼ì²˜ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.');
          return;
        }
        
        if (!file) {
          alert('íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.');
          return;
        }

        console.log('íŒŒì‹± ì‹œì‘:', file.name, 'ë°œì£¼ì²˜:', selectedCustomer);
        OB.showLoading('íŒŒì¼ì„ ì½ëŠ” ì¤‘...');

        var reader = new FileReader();
        
        reader.onload = function(e) {
          try {
            var data = new Uint8Array(e.target.result);
            var workbook = XLSX.read(data, { type: 'array' });
            
            var firstSheetName = workbook.SheetNames[0];
            var worksheet = workbook.Sheets[firstSheetName];
            
            var rows = XLSX.utils.sheet_to_json(worksheet, { 
              header: 1,
              defval: '',
              blankrows: false
            });

            console.log('ì—‘ì…€ ì½ê¸° ì™„ë£Œ. í–‰ ìˆ˜:', rows.length);
            
            if (rows.length === 0) {
              OB.hideLoading();
              alert('íŒŒì¼ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
              return;
            }

            OB.showLoading('ì„œë²„ì—ì„œ ë§¤ì¹­ ì¤‘...');
            
            google.script.run
              .withSuccessHandler(function(result) {
                OB.hideLoading();
                console.log('íŒŒì‹± ê²°ê³¼:', result);
                
                if (result && result.items) {
                  parsedItems = result.items.map(function(item) {
                    item.customer = selectedCustomer;
                    return item;
                  });
                  displayParseResult(result);
                  btnSave.disabled = false;
                } else {
                  alert('íŒŒì‹± ê²°ê³¼ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }
              })
              .withFailureHandler(function(error) {
                OB.hideLoading();
                console.error('íŒŒì‹± ì‹¤íŒ¨:', error);
                alert('íŒŒì‹± ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
              })
              .processParsedOrderRows(rows);

          } catch (err) {
            OB.hideLoading();
            console.error('íŒŒì¼ ì½ê¸° ì˜¤ë¥˜:', err);
            alert('íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + err.message);
          }
        };

        reader.onerror = function() {
          OB.hideLoading();
          alert('íŒŒì¼ ì½ê¸° ì‹¤íŒ¨');
        };

        reader.readAsArrayBuffer(file);
      });
    }

    /**
     * ì €ì¥ ë²„íŠ¼ í´ë¦­ - ì¤‘ë³µ ì²´í¬ í¬í•¨
     */
    if (btnSave) {
      btnSave.addEventListener('click', function() {
        if (!parsedItems || parsedItems.length === 0) {
          alert('ì €ì¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }

        var matchedItems = parsedItems.filter(function(item) {
          return item.matchStatus === 'MATCHED';
        });

        if (matchedItems.length === 0) {
          alert('ë§¤ì¹­ëœ í•­ëª©ì´ ì—†ì–´ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }

        // ì¤‘ë³µ ë°œì£¼ ì²´í¬
        checkDuplicateOrder(customerSelect.value, function(hasDuplicate, duplicates) {
          if (hasDuplicate) {
            showDuplicateWarning(duplicates, function(shouldContinue) {
              if (shouldContinue) {
                proceedSave(matchedItems);
              }
            });
          } else {
            proceedSave(matchedItems);
          }
        });
      });
    }

    /**
     * ì¤‘ë³µ ë°œì£¼ ì²´í¬
     */
    function checkDuplicateOrder(customer, callback) {
      var today = new Date();
      var todayStr = today.getFullYear() + '-' + 
                     String(today.getMonth() + 1).padStart(2, '0') + '-' + 
                     String(today.getDate()).padStart(2, '0');
      
      console.log('ğŸ” ì¤‘ë³µ ì²´í¬:', customer, todayStr);
      
      // ì„œë²„ì— ì¤‘ë³µ ì²´í¬ ìš”ì²­
      google.script.run
        .withSuccessHandler(function(result) {
          console.log('ì¤‘ë³µ ì²´í¬ ê²°ê³¼:', result);
          if (result && result.success) {
            callback(result.hasDuplicate, result.orders || []);
          } else {
            callback(false, []);
          }
        })
        .withFailureHandler(function(error) {
          console.error('ì¤‘ë³µ ì²´í¬ ì‹¤íŒ¨:', error);
          callback(false, []);
        })
        .checkTodayDuplicateOrder(customer, todayStr);
    }

    /**
     * ì¤‘ë³µ ê²½ê³  ëª¨ë‹¬ í‘œì‹œ
     */
    function showDuplicateWarning(duplicates, callback) {
      duplicateOrderList.innerHTML = '';
      
      duplicates.forEach(function(order) {
        var item = document.createElement('div');
        item.className = 'ob-modal-list-item';
        item.innerHTML = 
          '<strong>' + order.orderCode + '</strong><br>' +
          'ë¸Œëœë“œ: ' + order.brands + ' | ' +
          'ìƒí’ˆìˆ˜: ' + order.itemCount + 'ê°œ | ' +
          'ê¸ˆì•¡: â‚©' + formatNumber(order.totalAmount);
        duplicateOrderList.appendChild(item);
      });
      
      duplicateModal.classList.add('show');
      
      btnDuplicateCancel.onclick = function() {
        duplicateModal.classList.remove('show');
        callback(false);
      };
      
      btnDuplicateContinue.onclick = function() {
        duplicateModal.classList.remove('show');
        callback(true);
      };
    }

    /**
     * ì‹¤ì œ ì €ì¥ ì‹¤í–‰
     */
    function proceedSave(matchedItems) {
      var confirmMsg = 'ë§¤ì¹­ëœ ' + matchedItems.length + 'ê°œ í•­ëª©ì„ ë°œì£¼DBì— ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?';
      if (!confirm(confirmMsg)) {
        return;
      }

      console.log('DB ì €ì¥ ì‹œì‘. í•­ëª© ìˆ˜:', matchedItems.length);
      OB.showLoading('ë°œì£¼DBì— ì €ì¥ ì¤‘...');

      google.script.run
        .withSuccessHandler(function(result) {
          OB.hideLoading();
          console.log('ì €ì¥ ê²°ê³¼:', result);
          
          if (!result.success) {
            var errorMsg = 'âŒ ë°ì´í„° ê²€ì¦ ì‹¤íŒ¨!\n\n';
            errorMsg += 'ì´ ' + result.totalRows + 'ê°œ ì¤‘ ' + result.errorCount + 'ê±´ì˜ ì˜¤ë¥˜ ë°œê²¬\n\n';
            errorMsg += 'ã€ì˜¤ë¥˜ ë‚´ì—­ã€‘\n';
            errorMsg += result.errors.slice(0, 10).join('\n');
            
            if (result.errors.length > 10) {
              errorMsg += '\n... ì™¸ ' + (result.errors.length - 10) + 'ê±´';
            }
            
            errorMsg += '\n\nâš ï¸ ëª¨ë“  ë°ì´í„° ì €ì¥ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.';
            errorMsg += '\n\nì˜¤ë¥˜ë¥¼ ìˆ˜ì •í•œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
            
            alert(errorMsg);
            
            console.error('=== ì „ì²´ ì˜¤ë¥˜ ëª©ë¡ ===');
            result.errors.forEach(function(err) {
              console.error(err);
            });
            
            return;
          }
          
          if (result.savedRows !== undefined) {
            alert('âœ… ì €ì¥ ì™„ë£Œ!\n\n' + result.savedRows + 'ê°œ í•­ëª©ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            
            parsedItems = [];
            fileInput.value = '';
            customerSelect.value = '';
            btnSave.disabled = true;
            
            // UI ì´ˆê¸°í™”
            summaryCards.style.display = 'none';
            filterControls.style.display = 'none';
            tableBody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 40px; color: #9ca3af;">ì €ì¥ ì™„ë£Œ! ìƒˆ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.</td></tr>';
          } else {
            alert('âš ï¸ ì €ì¥ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          }
        })
        .withFailureHandler(function(error) {
          OB.hideLoading();
          console.error('ì €ì¥ ì‹¤íŒ¨:', error);
          alert('âŒ ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ\n\n' + error.message);
        })
        .saveParsedOrdersToDB(matchedItems);
    }

    /**
     * íŒŒì‹± ê²°ê³¼ í‘œì‹œ
     */
    function displayParseResult(result) {
      // ìš”ì•½ ì¹´ë“œ ì—…ë°ì´íŠ¸
      summaryTotal.textContent = result.parsedItems + 'ê°œ';
      summaryMatched.textContent = result.matchedCount + 'ê°œ';
      summaryUnmatched.textContent = 'ë¯¸ë§¤ì¹­ ' + result.unmatchedCount + 'ê°œ';
      summaryAmount.textContent = 'â‚©' + formatNumber(result.totalAmount);
      
      // ë¯¸ë§¤ì¹­ì´ ìˆìœ¼ë©´ ì¹´ë“œ ê°•ì¡°
      if (result.unmatchedCount > 0) {
        summaryMatchCard.classList.add('highlight');
      } else {
        summaryMatchCard.classList.remove('highlight');
      }
      
      summaryCards.style.display = 'grid';
      
      // ë¯¸ë§¤ì¹­ í•­ëª©ì´ ìˆì„ ë•Œë§Œ í•„í„° ë²„íŠ¼ í‘œì‹œ
      if (result.unmatchedCount > 0) {
        filterControls.style.display = 'flex';
      } else {
        filterControls.style.display = 'none';
      }

      // í…Œì´ë¸” ë Œë”ë§
      renderTable(result.items);
    }

    /**
     * í…Œì´ë¸” ë Œë”ë§
     */
    function renderTable(items) {
      tableBody.innerHTML = '';
      
      if (!items || items.length === 0) {
        var emptyRow = tableBody.insertRow();
        var emptyCell = emptyRow.insertCell();
        emptyCell.colSpan = 8;
        emptyCell.style.textAlign = 'center';
        emptyCell.style.padding = '40px';
        emptyCell.style.color = '#9ca3af';
        emptyCell.textContent = 'íŒŒì‹±ëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.';
        return;
      }

      items.forEach(function(item) {
        var row = tableBody.insertRow();
        
        // ë§¤ì¹­ ìƒíƒœì— ë”°ë¥¸ í´ë˜ìŠ¤ ì¶”ê°€
        if (item.matchStatus === 'MATCHED') {
          row.className = 'matched';
        } else {
          row.className = 'unmatched';
        }
        
        // í•„í„°ì— ë”°ë¼ ìˆ¨ê¹€ ì²˜ë¦¬
        if (currentFilter === 'unmatched' && item.matchStatus === 'MATCHED') {
          row.classList.add('hidden');
        }

        // ë°ì´í„° ì…€ ì¶”ê°€
        row.insertCell().textContent = item.seq || '';
        row.insertCell().textContent = item.brand || '';
        row.insertCell().textContent = item.productName || '';
        row.insertCell().textContent = item.barcode || '';
        
        var qtyCell = row.insertCell();
        qtyCell.className = 'num';
        qtyCell.textContent = formatNumber(item.orderQty);
        
        var priceCell = row.insertCell();
        priceCell.className = 'num';
        priceCell.textContent = formatNumber(item.supplyPrice);
        
        var amountCell = row.insertCell();
        amountCell.className = 'num';
        amountCell.textContent = formatNumber(item.orderAmount);
        
        // ìƒíƒœ ì…€ (ê°œì„ )
        var statusCell = row.insertCell();
        statusCell.className = 'status-cell';
        
        if (item.matchStatus === 'MATCHED') {
          statusCell.innerHTML = '<span class="status-text">âœ… ë§¤ì¹­</span>';
        } else {
          var reason = 'ë°”ì½”ë“œ ì—†ìŒ';
          if (item.barcode) {
            reason = 'í’ˆëª© ë¯¸ë“±ë¡';
          }
          statusCell.innerHTML = '<span class="status-text">âŒ ' + reason + '</span>';
        }
      });
    }

    /**
     * í•„í„° ë²„íŠ¼ ì´ë²¤íŠ¸
     */
    if (btnFilterUnmatched) {
      btnFilterUnmatched.addEventListener('click', function() {
        currentFilter = 'unmatched';
        applyFilter();
        btnFilterUnmatched.style.display = 'none';
        btnFilterAll.style.display = 'inline-block';
      });
    }
    
    if (btnFilterAll) {
      btnFilterAll.addEventListener('click', function() {
        currentFilter = 'all';
        applyFilter();
        btnFilterAll.style.display = 'none';
        btnFilterUnmatched.style.display = 'inline-block';
      });
    }

    /**
     * í•„í„° ì ìš©
     */
    function applyFilter() {
      var rows = tableBody.querySelectorAll('tr');
      rows.forEach(function(row) {
        if (currentFilter === 'unmatched') {
          if (row.classList.contains('matched')) {
            row.classList.add('hidden');
          } else {
            row.classList.remove('hidden');
          }
        } else {
          row.classList.remove('hidden');
        }
      });
    }

    /**
     * ìˆ«ì í¬ë§·
     */
    function formatNumber(num) {
      if (num === null || num === undefined || num === '') return '0';
      return Number(num).toLocaleString('ko-KR');
    }

  }; // end of OB.initOrderFilePage

</script>
Page_TransactionLedger.html
ì‹ ê·œ
+116
-0

<style>
  .ledger-wrap { padding: 20px; }
  .ledger-header { margin-bottom: 16px; }
  .ledger-header h1 { margin: 0 0 6px; font-size: 22px; font-weight: 700; color: #111827; }
  .ledger-header p { margin: 0; color: #6b7280; font-size: 13px; }

  .ledger-filter { display: flex; flex-wrap: wrap; gap: 12px; background: #fff; padding: 14px; border-radius: 8px; box-shadow: 0 1px 4px rgba(0,0,0,0.1); margin-bottom: 14px; align-items: flex-end; }
  .ledger-filter-field { display: flex; flex-direction: column; gap: 4px; }
  .ledger-filter-field label { font-size: 12px; color: #475569; font-weight: 600; }
  .ledger-filter-field input, .ledger-filter-field select { padding: 8px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 13px; min-width: 160px; }
  .ledger-btn { padding: 8px 14px; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 600; }
  .ledger-btn.primary { background: #2563eb; color: #fff; }
  .ledger-btn.secondary { background: #e5e7eb; color: #1f2937; }
  .ledger-btn.danger { background: #ef4444; color: #fff; }
  .ledger-btn.primary:hover { background: #1d4ed8; }
  .ledger-btn.secondary:hover { background: #d1d5db; }
  .ledger-btn.danger:hover { background: #dc2626; }

  .ledger-summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 10px; margin-bottom: 12px; }
  .ledger-summary-card { background: #fff; border-radius: 8px; padding: 12px; box-shadow: 0 1px 4px rgba(0,0,0,0.1); }
  .ledger-summary-label { font-size: 12px; color: #6b7280; margin-bottom: 4px; }
  .ledger-summary-value { font-size: 18px; font-weight: 700; color: #111827; }

  .ledger-table-wrap { background: #fff; border-radius: 8px; box-shadow: 0 1px 4px rgba(0,0,0,0.1); overflow: auto; max-height: 720px; }
  .ledger-table { width: 100%; border-collapse: collapse; font-size: 13px; }
  .ledger-table th, .ledger-table td { padding: 10px; border-bottom: 1px solid #e5e7eb; text-align: left; }
  .ledger-table th { background: #f8fafc; position: sticky; top: 0; z-index: 1; font-weight: 700; }
  .ledger-table td.num { text-align: right; }
  .ledger-status-badge { display: inline-block; padding: 3px 8px; border-radius: 999px; font-size: 11px; font-weight: 700; background: #e5e7eb; color: #374151; }
  .ledger-empty { text-align: center; padding: 40px 12px; color: #94a3b8; }

  .ledger-action-group { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
  .ledger-status-select { padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 12px; min-width: 120px; }
</style>

<div class="ledger-wrap">
  <div class="ledger-header">
    <h1>ê±°ë˜ì›ì¥</h1>
    <p>ê±°ë˜ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ê³  ìƒíƒœë¥¼ ì¦‰ì‹œ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.</p>
  </div>

  <div class="ledger-filter">
    <div class="ledger-filter-field">
      <label for="ledger-start-date">ì‹œì‘ì¼</label>
      <input type="date" id="ledger-start-date">
    </div>
    <div class="ledger-filter-field">
      <label for="ledger-end-date">ì¢…ë£Œì¼</label>
      <input type="date" id="ledger-end-date">
    </div>
    <div class="ledger-filter-field">
      <label for="ledger-company">ê±°ë˜ì²˜ (ë°œì£¼ì²˜)</label>
      <input type="text" id="ledger-company" placeholder="ê±°ë˜ì²˜ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" />
    </div>
    <div class="ledger-filter-field">
      <label for="ledger-status">ìƒíƒœ</label>
      <select id="ledger-status">
        <option value="">ì „ì²´</option>
        <option value="DRAFT">DRAFT</option>
        <option value="CONFIRMED">CONFIRMED</option>
        <option value="ISSUED">ISSUED</option>
        <option value="PAID">PAID</option>
        <option value="CANCELLED">CANCELLED</option>
      </select>
    </div>
    <div class="ledger-filter-field">
      <label for="ledger-order-code">ë°œì£¼ë²ˆí˜¸</label>
      <input type="text" id="ledger-order-code" placeholder="ì˜ˆ) 20250101-..." />
    </div>
    <button class="ledger-btn primary" id="ledger-search-btn">ì¡°íšŒ</button>
    <button class="ledger-btn secondary" id="ledger-reset-btn">ì´ˆê¸°í™”</button>
  </div>

  <div class="ledger-summary">
    <div class="ledger-summary-card">
      <div class="ledger-summary-label">ì´ ê±°ë˜ê±´ìˆ˜</div>
      <div class="ledger-summary-value" id="ledger-summary-count">0ê±´</div>
    </div>
    <div class="ledger-summary-card">
      <div class="ledger-summary-label">ë°œì£¼ìˆ˜ëŸ‰ í•©ê³„</div>
      <div class="ledger-summary-value" id="ledger-summary-order-qty">0</div>
    </div>
    <div class="ledger-summary-card">
      <div class="ledger-summary-label">í™•ì •ìˆ˜ëŸ‰ í•©ê³„</div>
      <div class="ledger-summary-value" id="ledger-summary-confirmed-qty">0</div>
    </div>
    <div class="ledger-summary-card">
      <div class="ledger-summary-label">ê³µê¸‰ì•¡ í•©ê³„</div>
      <div class="ledger-summary-value" id="ledger-summary-amount">â‚©0</div>
    </div>
  </div>

  <div class="ledger-table-wrap">
    <table class="ledger-table">
      <thead>
        <tr>
          <th>ë°œì£¼ì¼</th>
          <th>ë°œì£¼ë²ˆí˜¸</th>
          <th>ë°œì£¼ì²˜</th>
          <th>ë¸Œëœë“œ</th>
          <th>í’ˆëª©ì½”ë“œ</th>
          <th>ì œí’ˆëª…</th>
          <th class="num">ë°œì£¼ìˆ˜ëŸ‰</th>
          <th class="num">í™•ì •ìˆ˜ëŸ‰</th>
          <th class="num">ê³µê¸‰ê°€</th>
          <th class="num">ê³µê¸‰ì•¡</th>
          <th>ìƒíƒœ</th>
          <th>ì•¡ì…˜</th>
        </tr>
      </thead>
      <tbody id="ledger-tbody">
        <tr><td colspan="12" class="ledger-empty">ì¡°íšŒ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. í•„í„°ë¥¼ ì„¤ì • í›„ ì¡°íšŒí•˜ì„¸ìš”.</td></tr>
      </tbody>
    </table>
  </div>
</div>
RemainingWorkAssessment.md
ì‹ ê·œ
+16
-0

# Remaining Work Assessment (2025-12-06 ìƒíƒœ)

ë³¸ ë¬¸ì„œëŠ” í˜„ì¬ ì €ì¥ì†Œ ê¸°ì¤€ ERP ê°œë°œì˜ ì”ì—¬ ì‘ì—… ì—¬ë¶€ë¥¼ ìš”ì•½í•œë‹¤.

## 1. ìµœê·¼ ì²˜ë¦¬ëœ í•­ëª©
- **#005 Page_OrderFile.html ìŠ¤í¬ë¦½íŠ¸ ë¶„ë¦¬**: í˜ì´ì§€ ë§ë¯¸ì˜ `<script>` ë¸”ë¡ì„ `CommonScripts.html`ì˜ `OB.initOrderFilePage`ë¡œ ì´ë™í•´ SSR/SPA ê·œì¹™ì„ ì¤€ìˆ˜í•˜ë„ë¡ ì •ë¦¬í–ˆë‹¤.ã€F:Page_OrderFile.htmlâ€ L1-L374ã€‘ã€F:CommonScripts.htmlâ€ L41-L270ã€‘
- **#006 getCustomers() ì¤‘ë³µ ì œê±°**: ì„œë²„ í•¨ìˆ˜ë¥¼ `ApiService.js`ë¡œ ì¼ì›í™”í•˜ê³  ê±°ë˜ì²˜ í•„í„°ë§/ë°˜í™˜ ê°’ì„ ì¬ì •ë ¬í–ˆìœ¼ë©°, `OrderParsingService.js`ì˜ ì¤‘ë³µ ì •ì˜ë¥¼ ì‚­ì œí–ˆë‹¤.ã€F:ApiService.jsâ€ L473-L520ã€‘ã€F:OrderParsingService.jsâ€ L647-L706ã€‘
- **safeReturn ì ìš© ì¬ì ê²€**: `ApiService.js`ì˜ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ ë˜í¼ì— `safeReturn()`ì„ ì ìš©í–ˆìŒì„ í™•ì¸í•˜ê³  v2.3 ë‹¨ê¸° ê³¼ì œì— ì™„ë£Œë¡œ ë°˜ì˜í–ˆë‹¤.ã€F:ApiService.jsâ€ L16-L31ã€‘ã€F:ApiService.jsâ€ L700-L903ã€‘ã€F:OneBridge_ERP_Architecture_v2.2.mdâ€ L842-L861ã€‘
- **ë¬¸ì„œ ìµœì‹ í™”**: ì•„í‚¤í…ì²˜ì˜ ì•Œë ¤ì§„ ì´ìŠˆ ë° ë‹¨ê¸° ê³„íš ì„¹ì…˜ì„ ìµœì‹  ìƒíƒœë¡œ ê°±ì‹ í•´ í•´ê²°ëœ í•­ëª©(#005~#011)ì„ ë°˜ì˜í–ˆë‹¤.ã€F:OneBridge_ERP_Architecture_v2.2.mdâ€ L834-L869ã€‘

## 2. ì—¬ì „íˆ í™•ì¸ì´ í•„ìš”í•œ í•­ëª©
- **ëª…ëª… ê·œì¹™ í†µì¼**: API/ì„œë¹„ìŠ¤ í•¨ìˆ˜ì˜ ë„¤ì´ë° ì¼ê´€í™” ê·œì¹™ í™•ì • ë° ì ìš© í•„ìš”.ã€F:OneBridge_ERP_Architecture_v2.2.mdâ€ L870-L876ã€‘
- **ì—ëŸ¬ ì²˜ë¦¬ í‘œì¤€í™”**: ì˜ˆì™¸ ë©”ì‹œì§€ í¬ë§·Â·ë¡œê¹… ê·œì¹™ì„ ì •ì˜í•˜ê³  ì„œë¹„ìŠ¤ë³„ë¡œ ë°˜ì˜í•´ì•¼ í•¨.ã€F:OneBridge_ERP_Architecture_v2.2.mdâ€ L870-L876ã€‘

## 3. ê²°ë¡ 
- ì£¼ìš” ë¯¸í•´ê²° ì´ìŠˆ(#005~#011)ì™€ safeReturn ì¬ì ê²€, ë¬¸ì„œ ìµœì‹ í™”ê°€ ì™„ë£Œë˜ì–´ ê¸°ëŠ¥ìƒ ëˆ„ë½ì€ í•´ì†Œë˜ì—ˆë‹¤. ë‚¨ì€ ì‘ì—…ì€ ëª…ëª… ê·œì¹™ ë° ì—ëŸ¬ ì²˜ë¦¬ í‘œì¤€í™” ê°™ì€ v2.3 í’ˆì§ˆ ì‘ì—…ì´ë‹¤.
SettlementService.js
+102
-0

@@ -570,50 +570,152 @@ function getSalesSettlements(params) {
        totalItems: data[i][6],
        totalOrderQty: data[i][7],
        totalConfirmedQty: data[i][8],
        totalSupplyAmount: data[i][9],
        diffQty: data[i][10],
        notes: data[i][11],
        createdAt: formatDateString(data[i][12]),
        createdBy: data[i][13]
      });
    }

    return {
      success: true,
      settlements: settlements
    };

  } catch (err) {
    Logger.log('[getSalesSettlements Error] ' + err.message);
    return {
      success: false,
      error: err.message
    };
  }
}

/**
 * íŠ¹ì • ë§ˆê°ì˜ ìƒì„¸ ì •ë³´ì™€ ì§‘ê³„ ë°ì´í„°ë¥¼ ì¡°íšŒ
 * @param {Object} params - { settlementId, type }
 * @returns {Object} ìƒì„¸ ì •ë³´ ë° ì•„ì´í…œ ëª©ë¡
 */
function getSettlementDetail(params) {
  try {
    var settlementId = params && params.settlementId ? String(params.settlementId) : '';
    var type = params && params.type ? String(params.type) : '';

    if (!settlementId) {
      return {
        success: false,
        error: 'ë§ˆê°IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'
      };
    }

    var sheetName = type === 'SALES' ? OB_SALES_SETTLEMENT_SHEET : OB_PURCHASE_SETTLEMENT_SHEET;
    var ss = SpreadsheetApp.openById(OB_SETTLEMENT_SS_ID);
    var sheet = ss.getSheetByName(sheetName);

    if (!sheet) {
      return {
        success: false,
        error: 'ë§ˆê° ì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'
      };
    }

    var data = sheet.getDataRange().getValues();
    var settlementRow = null;

    for (var i = 1; i < data.length; i++) {
      if (String(data[i][0]) === settlementId) {
        settlementRow = data[i];
        break;
      }
    }

    if (!settlementRow) {
      return {
        success: false,
        error: 'í•´ë‹¹ ë§ˆê°ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'
      };
    }

    var resolvedType = settlementRow[1] || type || '';
    var isSales = resolvedType === 'SALES';

    var partner = isSales ? (settlementRow[2] || '') : (settlementRow[2] || '');
    var startDate = formatDateString(settlementRow[3]);
    var endDate = formatDateString(settlementRow[4]);

    // ìƒì„¸ ì•„ì´í…œì€ ìµœì‹  ì§‘ê³„ ê²°ê³¼ë¡œ ì¡°íšŒ
    var aggregateParams = isSales
      ? { buyer: partner, startDate: startDate, endDate: endDate }
      : { supplier: partner, startDate: startDate, endDate: endDate };

    var aggregateResult = isSales
      ? aggregateSalesOrders(aggregateParams)
      : aggregatePurchaseOrders(aggregateParams);

    if (!aggregateResult || !aggregateResult.success) {
      return {
        success: false,
        error: aggregateResult && aggregateResult.error ? aggregateResult.error : 'ë§ˆê° ìƒì„¸ ì§‘ê³„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'
      };
    }

    var settlement = {
      settlementId: settlementId,
      type: resolvedType || (isSales ? 'SALES' : 'PURCHASE'),
      partner: partner,
      startDate: startDate,
      endDate: endDate,
      status: settlementRow[5] || 'DRAFT',
      totalItems: settlementRow[6] || aggregateResult.totalItems,
      totalOrderQty: settlementRow[7] || aggregateResult.totalOrderQty,
      totalConfirmedQty: settlementRow[8] || aggregateResult.totalConfirmedQty,
      totalAmount: isSales ? (settlementRow[9] || aggregateResult.totalSupplyAmount) : (settlementRow[9] || aggregateResult.totalPurchaseAmount),
      diffQty: settlementRow[10] || aggregateResult.diffQty,
      notes: settlementRow[11] || '',
      createdAt: formatDateString(settlementRow[12]),
      createdBy: settlementRow[13] || '',
      confirmedAt: formatDateString(settlementRow[14]),
      confirmedBy: settlementRow[15] || ''
    };

    return {
      success: true,
      settlement: settlement,
      items: aggregateResult.items || []
    };

  } catch (err) {
    Logger.log('[getSettlementDetail Error] ' + err.message);
    return {
      success: false,
      error: 'ë§ˆê° ìƒì„¸ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + err.message
    };
  }
}

/**
 * ============================================================
 * 3. ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
 * ============================================================
 */

/**
 * ë‚ ì§œë¥¼ YYYY-MM-DD í˜•ì‹ ë¬¸ìì—´ë¡œ ë³€í™˜
 */
function formatDateString(date) {
  if (!date) return '';
  if (typeof date === 'string') return date;

  var d = new Date(date);
  if (isNaN(d.getTime())) return '';

  var year = d.getFullYear();
  var month = String(d.getMonth() + 1).padStart(2, '0');
  var day = String(d.getDate()).padStart(2, '0');

  return year + '-' + month + '-' + day;
}

/**
 * ë‚ ì§œë¥¼ YYYYMM í˜•ì‹ìœ¼ë¡œ ë³€í™˜
TestExecutionReport.md
ì‹ ê·œ
+40
-0

# ì‚¬ìš©ì ì‹œë®¬ë ˆì´ì…˜ ê¸°ë°˜ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë³´ê³ ì„œ

`UserSimulationScenarios.md`ì— ì •ì˜ëœ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ê¸°ì¤€ìœ¼ë¡œ, í˜„ì¬ ë¦¬í¬ì§€í† ë¦¬ ìƒíƒœì—ì„œ ì‹¤í–‰ ê°€ëŠ¥í•œ ë²”ìœ„ë¥¼ ì ê²€í–ˆìŠµë‹ˆë‹¤. ì´ í”„ë¡œì íŠ¸ëŠ” Google Apps Script( `google.script.run` ) í™˜ê²½ì„ ì „ì œë¡œ ì‘ì„±ë˜ì–´ ìˆìœ¼ë¯€ë¡œ, ë¡œì»¬ ì •ì  HTMLë§Œìœ¼ë¡œëŠ” API í˜¸ì¶œì„ ì‹¤í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

## ê³µí†µ í™˜ê²½
- í™•ì¸ ëŒ€ìƒ: ì •ì  HTML/JS (`Page_*.html`, `CommonScripts.html` ë“±)
- í•œê³„: ë°±ì—”ë“œ API ì‘ë‹µ/ë°ì´í„° ë¯¸ì¡´ì¬, ë¸Œë¼ìš°ì € ì‹¤í–‰ í™˜ê²½ ë¯¸êµ¬ì„± â†’ ì‹¤ì œ ìš”ì²­/ì‘ë‹µ íë¦„ì€ ê²€ì¦ ë¶ˆê°€

## í˜ì´ì§€ë³„ ì ê²€ ê²°ê³¼
### 1) ì£¼ë¬¸ íŒŒì¼ ì—…ë¡œë“œ & íŒŒì‹± (Page_OrderFile)
- **ìƒíƒœ**: `FileReader`ì™€ SheetJSë¥¼ í†µí•´ ë¸Œë¼ìš°ì €ì—ì„œ íŒŒì¼ì„ ì½ê³ , `processParsedOrderRows`ë¥¼ `google.script.run`ìœ¼ë¡œ í˜¸ì¶œí•´ íŒŒì‹±Â·ë§¤ì¹­ ê²°ê³¼ë¥¼ ë°›ì•„ í…Œì´ë¸”/ìš”ì•½ ì¹´ë“œë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤. GAS í™˜ê²½ì—ì„œëŠ” ì—…ë¡œë“œÂ·íŒŒì‹±Â·ì¤‘ë³µ ì²´í¬Â·ì €ì¥ì´ ì •ìƒ ë™ì‘í•˜ë„ë¡ êµ¬í˜„ë¼ ìˆìœ¼ë©°, ë¡œì»¬ ì •ì  ë¯¸ë¦¬ë³´ê¸°ë§Œìœ¼ë¡œëŠ” `google.script.run` í˜¸ì¶œì´ ë§‰í˜€ ì‹¤í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- **ì¶”ê°€ í•„ìš”**: ë¡œì»¬ì—ì„œ ë™ì¼ íë¦„ì„ ì¬í˜„í•˜ë ¤ë©´ GAS ëŸ°íƒ€ì„(ë˜ëŠ” `google.script.run`ì„ ëª¨í‚¹í•œ í…ŒìŠ¤íŠ¸ í•˜ë„¤ìŠ¤)ì´ í•„ìš”í•©ë‹ˆë‹¤.

### 2) ì£¼ë¬¸ ëª©ë¡ ì¡°íšŒ/í•„í„°ë§ (Page_OrderList)
- **ìƒíƒœ**: ê²€ìƒ‰ í¼, í…Œì´ë¸” ë Œë”ë§, `initOrderListPage` í˜¸ì¶œ ê²½ë¡œ í™•ì¸. API ì—°ê²° ì—¬ë¶€ë¥¼ ì½”ë“œë¡œë§Œ ì¶”ì í–ˆìœ¼ë©° ì‹¤ ë°ì´í„° ì¡°íšŒëŠ” ë¯¸ì‹¤í–‰.
- **ì¶”ê°€ í•„ìš”**: `/getOrders` ë“± ëª©ë¡ ì¡°íšŒ API ëª¨í‚¹/ì‹¤ ì„œë²„ ì—°ê²°.

### 3) ë§¤ì… ì •ì‚° (Page_PurchaseSettlement)
- **ìƒíƒœ**: í˜ì´ì§€ ì´ˆê¸°í™” ë° ë²„íŠ¼ ì´ë²¤íŠ¸ ë°”ì¸ë”© ì¡´ì¬ í™•ì¸. ì •ì‚° ìƒì„±/ìƒì„¸ ëª¨ë‹¬/ìƒíƒœ ë³€ê²½ì€ API ì—°ë™ ì „ì œë¼ ì‹¤ì œ ê²°ê³¼ í™•ì¸ ë¶ˆê°€.
- **ì¶”ê°€ í•„ìš”**: ì •ì‚° ìƒì„±Â·ìƒíƒœ ë³€ê²½ API ëª¨í‚¹.

### 4) ë§¤ì¶œ ì •ì‚° (Page_SalesSettlement)
- **ìƒíƒœ**: í…Œì´ë¸”/ìš”ì•½ ì¹´ë“œ/ìƒì„¸ ë³´ê¸° ë²„íŠ¼ êµ¬ì¡° í™•ì¸. PDF ì¶œë ¥Â·ìƒíƒœ ë³€ê²½ ì‹œë‚˜ë¦¬ì˜¤ëŠ” API ë° íŒŒì¼ ì¶œë ¥ ì˜ì¡´ìœ¼ë¡œ ì‹¤í–‰ ë¶ˆê°€.
- **ì¶”ê°€ í•„ìš”**: ë§¤ì¶œ ì •ì‚° ì¡°íšŒ/ì—…ë°ì´íŠ¸ API, PDF ì¶œë ¥ ì„œë¹„ìŠ¤ ëª¨í‚¹.

### 5) ì²­êµ¬ì„œ ê´€ë¦¬ (Page_BillingManagement)
- **ìƒíƒœ**: ê²€ìƒ‰ í¼Â·ëª©ë¡Â·ëª¨ë‹¬ ë¼ˆëŒ€ ë° ì´ë²¤íŠ¸ ë°”ì¸ë”© í™•ì¸. ìƒíƒœ ë³€ê²½(DRAFTâ†’ISSUED/PAID) íë¦„ì€ API ì‘ë‹µ í•„ìš”ë¡œ ë¯¸ê²€ì¦.
- **ì¶”ê°€ í•„ìš”**: ì²­êµ¬ì„œ ì¡°íšŒ/ìƒíƒœ ë³€ê²½ API ëª¨í‚¹.

### 6) ì¸ë³´ì´ìŠ¤ ì¶œë ¥ (Page_InvoiceOutput)
- **ìƒíƒœ**: ì…ë ¥ í¼Â·ì¶œë ¥ ë²„íŠ¼Â·í…œí”Œë¦¿ ì„ íƒ UI í™•ì¸. ì‹¤ì œ PDF ìƒì„±/ì¬ì¶œë ¥ì€ ì„œë²„ í…œí”Œë¦¿ ì—”ì§„ ì˜ì¡´ìœ¼ë¡œ ë¯¸ì‹¤í–‰.
- **ì¶”ê°€ í•„ìš”**: ì¸ë³´ì´ìŠ¤ ì¶œë ¥ API/í…œí”Œë¦¿ ì—”ì§„ ëª¨í‚¹.

### 7) ì›”ë§ˆê° (Page_MonthlyClosing)
- **ìƒíƒœ**: ì›” ì„ íƒÂ·ì¡°íšŒÂ·ë§ˆê° ì‹¤í–‰ ë²„íŠ¼ êµ¬ì¡°ì™€ `initMonthlyClosingPage` í˜¸ì¶œ í™•ì¸. ë§ˆê° ì‹¤í–‰/ì·¨ì†Œ/ë¡œê·¸ ì¡°íšŒëŠ” ì„œë²„ ë°ì´í„° í•„ìš”ë¡œ ë¯¸ê²€ì¦.
- **ì¶”ê°€ í•„ìš”**: ë§ˆê° ì¡°íšŒ/ì‹¤í–‰ API ëª¨í‚¹.

## ê²°ë¡ 
- ì‹œë‚˜ë¦¬ì˜¤ë³„ UI êµ¬ì¡°ì™€ ì´ˆê¸°í™” ê²½ë¡œëŠ” ëª¨ë‘ í™•ì¸í–ˆìœ¼ë‚˜, ì‹¤ì œ ë™ì‘ ê²€ì¦ì€ ë°±ì—”ë“œÂ·ì‹¤ë°ì´í„° ë¶€ì¬ë¡œ ìˆ˜í–‰í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.
- í…ŒìŠ¤íŠ¸ ê°€ëŠ¥ ìƒíƒœë¡œ ë§Œë“¤ê¸° ìœ„í•´ì„œëŠ” ê° í˜ì´ì§€ë³„ API ëª¨í‚¹ ë˜ëŠ” ìŠ¤í…Œì´ì§• ì„œë²„ ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤. ëª¨í‚¹ ì„¤ì •ì„ ì œê³µí•´ì£¼ì‹œë©´ ì‹œë‚˜ë¦¬ì˜¤ë³„ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ë¥¼ ì™„ë£Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
UiService.js
+6
-0

/**
 * HTML include helper
 */
function include(filename) {
  return HtmlService.createHtmlOutputFromFile(filename).getContent();
}

function getPageContent(page) {
  var templateName = getPageTemplateName_(page);
  var t = HtmlService.createTemplateFromFile(templateName);
  t.page = page;
  return t.evaluate().getContent();
}

function getPageTemplateName_(page) {
  switch (page) {
    case 'orderFile':
      return 'Page_OrderFile';
    case 'dashboard':
      return 'Page_Dashboard';
    case 'orderList':
      return 'Page_OrderList';
    case 'invoiceOutput':
      return 'Page_InvoiceOutput';
    case 'transactionLedger':
      return 'Page_TransactionLedger';
    case 'purchaseSettlement':
      return 'Page_PurchaseSettlement';
    case 'salesSettlement':
      return 'Page_SalesSettlement';
    case 'monthlyClosing':
      return 'Page_MonthlyClosing';
    case 'billingManagement':
      return 'Page_BillingManagement';
    case 'invoiceManagement':
      return 'Page_InvoiceManagement';
    case 'settings':
      return 'Page_Settings';
    default:
      return 'Page_OrderFile';
  }
}

function initCurrentPage(page) {
  if (page === "invoiceOutput" &&
      typeof OB.initInvoiceOutputPage === "function") {
    OB.initInvoiceOutputPage();
  }
}
UserSimulationScenarios.md
ì‹ ê·œ
+58
-0

# ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤ ì‹œë®¬ë ˆì´ì…˜ ê°€ì´ë“œ

ì•„ë˜ ì‹œë‚˜ë¦¬ì˜¤ëŠ” í˜„ì¬ êµ¬í˜„ëœ ERP ì›¹ì•±ì˜ ì£¼ìš” í™”ë©´/ê¸°ëŠ¥ì„ ì‹¤ì œ ì‚¬ìš©ì ê´€ì ì—ì„œ ì ê²€í•˜ê¸° ìœ„í•œ ì˜ˆì‹œì…ë‹ˆë‹¤.
ê° ê¸°ëŠ¥ë³„ë¡œ ì•½ 5ê°œ ì •ë„ì˜ ìƒí™©ì„ êµ¬ì„±í•˜ê³ , ì…ë ¥ ê°’, ê¸°ëŒ€ ë™ì‘, ì•Œë¦¼/ìƒíƒœ ë³€í™”ë¥¼ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤.

## 1) ì£¼ë¬¸ íŒŒì¼ ì—…ë¡œë“œ & íŒŒì‹± (Page_OrderFile)
1. **í‘œì¤€ ì£¼ë¬¸ì„œ ì—…ë¡œë“œ**: `*_order.xlsx` íŒŒì¼ì„ ì˜¬ë ¤ íŒŒì‹± ê²°ê³¼ê°€ í…Œì´ë¸”ì— í‘œì‹œë˜ëŠ”ì§€ í™•ì¸í•œë‹¤.
   ì—…ë¡œë“œ ì„±ê³µ í† ìŠ¤íŠ¸ê°€ ëœ¨ê³  íŒŒì‹±ëœ í–‰ ìˆ˜ê°€ OB ìƒíƒœì— ì €ì¥ë˜ëŠ”ì§€ ë³¸ë‹¤.
2. **í•„ìˆ˜ ì»¬ëŸ¼ ëˆ„ë½ íŒŒì¼**: `ITEM_CODE`ê°€ ì—†ëŠ” íŒŒì¼ì„ ì—…ë¡œë“œí•´ ì—ëŸ¬ ë©”ì‹œì§€ì™€ ì¤‘ë‹¨ ë™ì‘ì„ í™•ì¸í•œë‹¤.
3. **ì¤‘ë³µ ì£¼ë¬¸ ID í¬í•¨ íŒŒì¼**: ë™ì¼í•œ `ORDER_ID`ê°€ ìˆëŠ” íŒŒì¼ì„ ì˜¬ë ¤ ì¤‘ë³µ ê²½ê³ ì™€ ë³‘í•©/ìŠ¤í‚µ ë°˜ì˜ ì—¬ë¶€ë¥¼ ë³¸ë‹¤.
4. **ëŒ€ìš©ëŸ‰ íŒŒì¼(ì˜ˆ: 5ë§Œ í–‰)**: ì—…ë¡œë“œ ì¤‘ ë¡œë”© ì˜¤ë²„ë ˆì´ê°€ ìœ ì§€ë˜ê³ , íŒŒì‹±ì´ ê¸¸ì–´ë„ UIê°€ ë©ˆì¶”ì§€ ì•ŠëŠ”ì§€ í™•ì¸í•œë‹¤.
5. **ì˜ëª»ëœ í™•ì¥ì ì—…ë¡œë“œ**: `.csv`ë‚˜ `.txt` íŒŒì¼ ì„ íƒ ì‹œ í—ˆìš©ë˜ì§€ ì•ŠëŠ” í˜•ì‹ ì•ˆë‚´ê°€ ì¦‰ì‹œ ë…¸ì¶œë˜ëŠ”ì§€ ë³¸ë‹¤.

## 2) ì£¼ë¬¸ ëª©ë¡ ì¡°íšŒ/í•„í„°ë§ (Page_OrderList)
1. **íšŒì‚¬ëª… í•„í„°**: `ABCìƒì‚¬`ë¡œ ê²€ìƒ‰í•´ í•´ë‹¹ íšŒì‚¬ ì£¼ë¬¸ë§Œ ë¦¬ìŠ¤íŠ¸ì— ë‚˜íƒ€ë‚˜ê³  ìš”ì•½ ì¹´ë“œê°€ ë™ì¼í•˜ê²Œ ê°±ì‹ ë˜ëŠ”ì§€ ë³¸ë‹¤.
2. **ê¸°ê°„ í•„í„°**: `ë‹¹ì›” 1ì¼~ë§ì¼` ê²€ìƒ‰ ì‹œ ë‹¹ì›” ì£¼ë¬¸ë§Œ ë…¸ì¶œë˜ëŠ”ì§€ í™•ì¸í•œë‹¤.
3. **ìƒíƒœ í•„í„°**: ìƒíƒœë¥¼ `í™•ì •`ìœ¼ë¡œ ì„¤ì • í›„ ê²€ìƒ‰í•´ ë‹¤ë¥¸ ìƒíƒœê°€ í¬í•¨ë˜ì§€ ì•ŠëŠ”ì§€ í™•ì¸í•œë‹¤.
4. **ë‹¤ì¤‘ ì¡°ê±´ ê²€ìƒ‰**: íšŒì‚¬ëª…+ê¸°ê°„+ìƒíƒœë¥¼ ëª¨ë‘ ì§€ì •í•˜ê³  êµì°¨ í•„í„°ë§ì´ ì •í™•íˆ ì ìš©ë˜ëŠ”ì§€ í™•ì¸í•œë‹¤.
5. **ì´ˆê¸°í™” ë™ì‘**: ì´ˆê¸°í™” ë²„íŠ¼ìœ¼ë¡œ ì…ë ¥ í•„í„°ê°€ ê¸°ë³¸ê°’ìœ¼ë¡œ ëŒì•„ê°€ê³  ë¦¬ìŠ¤íŠ¸ê°€ ë¹ˆ ìƒíƒœë¡œ ë¦¬ì…‹ë˜ëŠ”ì§€ ë³¸ë‹¤.

## 3) ë§¤ì… ì •ì‚° (Page_PurchaseSettlement)
1. **ì •ì‚° ìƒì„±**: ì—¬ëŸ¬ ë¯¸ì •ì‚° ì£¼ë¬¸ì„ ì„ íƒ í›„ `ì •ì‚° ìƒì„±`ì„ ëˆŒëŸ¬ ìƒˆ ì •ì‚° IDê°€ ë§Œë“¤ì–´ì§€ê³  ëª©ë¡/ìš”ì•½ ì¹´ë“œê°€ ê°±ì‹ ë˜ëŠ”ì§€ í™•ì¸í•œë‹¤.
2. **ìˆ˜ì •ëœ í™•ì •ìˆ˜ëŸ‰ ë°˜ì˜**: ì£¼ë¬¸ ìƒì„¸ì—ì„œ í™•ì •ìˆ˜ëŸ‰ì„ ìˆ˜ì •í•œ ë’¤ ì •ì‚°ì„ ë§Œë“¤ ë•Œ ìˆ˜ì • ìˆ˜ëŸ‰ ê¸°ì¤€ìœ¼ë¡œ ê¸ˆì•¡ì´ ê³„ì‚°ë˜ëŠ”ì§€ ë³¸ë‹¤.
3. **ê³µê¸‰ê°€/ë¶€ê°€ì„¸ ê²€ì¦**: ë‹¨ê°€Â·ìˆ˜ëŸ‰ì„ ê°€ì§„ ì£¼ë¬¸ìœ¼ë¡œ ì •ì‚° ìƒì„± ì‹œ ê³µê¸‰ê°€, ë¶€ê°€ì„¸, í•©ê³„ê°€ ì •í™•íˆ ê³„ì‚°ë˜ëŠ”ì§€ í™•ì¸í•œë‹¤.
4. **ì •ì‚° ë©”ëª¨**: ì •ì‚° ìƒì„± ì‹œ ì…ë ¥í•œ ë©”ëª¨ê°€ ìƒì„¸ ëª¨ë‹¬ê³¼ ëª©ë¡ì— í•¨ê»˜ ë…¸ì¶œë˜ëŠ”ì§€ ë³¸ë‹¤.
5. **ìƒíƒœ ë³€ê²½(ì„ì‹œâ†’í™•ì •)**: ìƒì„±ëœ ì •ì‚°ì„ í™•ì •ìœ¼ë¡œ ë°”ê¿€ ë•Œ í™•ì¸ íŒì—…, ì„±ê³µ ì•Œë¦¼, ìƒíƒœ ë°°ì§€ ì—…ë°ì´íŠ¸ê°€ ì´ë£¨ì–´ì§€ëŠ”ì§€ í™•ì¸í•œë‹¤.

## 4) ë§¤ì¶œ ì •ì‚° (Page_SalesSettlement)
1. **ê±°ë˜ì²˜ë³„ í•„í„°**: íŠ¹ì • ê³ ê°ì‚¬ë¥¼ ì„ íƒí•˜ê³  ê²€ìƒ‰í•´ í•´ë‹¹ ê±°ë˜ì²˜ì˜ ë§¤ì¶œ ì •ì‚°ë§Œ í‘œì— ë‚˜íƒ€ë‚˜ëŠ”ì§€ í™•ì¸í•œë‹¤.
2. **í•©ê³„ ì¼ì¹˜ ì—¬ë¶€**: ê²€ìƒ‰ ê²°ê³¼ ì´ ê¸ˆì•¡ì´ ìš”ì•½ ì¹´ë“œì™€ í…Œì´ë¸” í‘¸í„° í•©ê³„ì— ë™ì¼í•˜ê²Œ í‘œì‹œë˜ëŠ”ì§€ ë¹„êµí•œë‹¤.
3. **ì •ì‚° ìƒì„¸ ë³´ê¸°**: ìƒì„¸ ë²„íŠ¼ì„ ëˆŒëŸ¬ í•­ëª©ë³„ ê¸ˆì•¡, ì„¸ë¶€ í’ˆëª©, ìƒì„±ì ì •ë³´ê°€ ì˜¬ë°”ë¥´ê²Œ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸í•œë‹¤.
4. **PDF ì¶œë ¥ ë²„íŠ¼**: ì¶œë ¥ ë²„íŠ¼ í´ë¦­ ì‹œ PDF ë¯¸ë¦¬ë³´ê¸°/ë‹¤ìš´ë¡œë“œê°€ ë™ì‘í•˜ê³  ë¡œë”© ì˜¤ë²„ë ˆì´ê°€ í‘œì‹œë˜ëŠ”ì§€ ì ê²€í•œë‹¤.
5. **ì •ì‚° ìƒíƒœ ì—…ë°ì´íŠ¸**: `ë°œí–‰ì™„ë£Œ`ì—ì„œ `ì…ê¸ˆì™„ë£Œ`ë¡œ ë³€ê²½ í›„ ìƒíƒœ ë°°ì§€ì™€ ë¯¸ìˆ˜ê¸ˆ ì¹´ë“œê°€ ì¦‰ì‹œ ê°±ì‹ ë˜ëŠ”ì§€ í™•ì¸í•œë‹¤.

## 5) ì²­êµ¬ì„œ ê´€ë¦¬ (Page_BillingManagement)
1. **ê¸°ë³¸ ë‚ ì§œ ì¡°íšŒ**: í˜ì´ì§€ ì§„ì… í›„ ë‹¹ì›” 1ì¼~ë§ì¼ ë²”ìœ„ì—ì„œ ê²€ìƒ‰ì„ ëˆŒëŸ¬ ê¸°ë³¸ ì²­êµ¬ì„œ ëª©ë¡ì´ ë¡œë“œë˜ëŠ”ì§€ í™•ì¸í•œë‹¤.
2. **íšŒì‚¬ëª…+ìƒíƒœ í•„í„°**: íšŒì‚¬ëª…ê³¼ ìƒíƒœë¥¼ `ë°œí–‰ì™„ë£Œ`ë¡œ ì„¤ì •í•´ ì¡°ê±´ì— ë§ëŠ” ì²­êµ¬ì„œë§Œ í‘œì‹œë˜ê³  ìš”ì•½ ì¹´ë“œ ê¸ˆì•¡ì´ ì¼ê´€ë˜ëŠ”ì§€ ë³¸ë‹¤.
3. **ìƒì„¸ ëª¨ë‹¬ ê²€ì¦**: `ìƒì„¸` ë²„íŠ¼ìœ¼ë¡œ ì²­êµ¬ì„œ ë²ˆí˜¸, ì •ì‚° ID, ê¸ˆì•¡, ìƒíƒœ, ìƒì„±/ë°œí–‰/ì…ê¸ˆ ì´ë ¥ì´ ì •í™•íˆ í‘œì‹œë˜ëŠ”ì§€ ì ê²€í•œë‹¤.
4. **ìƒíƒœ ë³€ê²½(DRAFTâ†’ISSUED)**: ëª¨ë‹¬ì—ì„œ ìƒíƒœë¥¼ ë°œí–‰ì™„ë£Œë¡œ ë°”ê¿€ ë•Œ í™•ì¸ íŒì—…, ì„±ê³µ ì•Œë¦¼, ëª©ë¡ ìë™ ìƒˆë¡œê³ ì¹¨ì´ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•œë‹¤.
5. **ìƒíƒœ ë³€ê²½(ISSUEDâ†’PAID)**: ë°œí–‰ì™„ë£Œ ìƒíƒœ ì²­êµ¬ì„œë¥¼ ì…ê¸ˆì™„ë£Œë¡œ ë³€ê²½í•´ ìš”ì•½ ì¹´ë“œ ë¯¸ìˆ˜ê¸ˆì´ ê°ì†Œí•˜ê³  ìƒíƒœ ë°°ì§€ê°€ ì—…ë°ì´íŠ¸ë˜ëŠ”ì§€ ë³¸ë‹¤.

## 6) ì¸ë³´ì´ìŠ¤ ì¶œë ¥ (Page_InvoiceOutput)
1. **ì •ì‚° ID ì¶œë ¥**: ìœ íš¨í•œ ì •ì‚° ID ì…ë ¥ í›„ ì¶œë ¥ ë²„íŠ¼ì„ ëˆŒëŸ¬ PDF í…œí”Œë¦¿ì´ ìƒì„±ë˜ê³  ë¯¸ë¦¬ë³´ê¸°ê°€ ë¡œë“œë˜ëŠ”ì§€ í™•ì¸í•œë‹¤.
2. **í…œí”Œë¦¿ íƒ€ì… ì „í™˜**: VAT í¬í•¨/ë¯¸í¬í•¨ í…œí”Œë¦¿ì„ ì „í™˜í•´ ê¸ˆì•¡ í‘œê¸°ê°€ ì ì ˆíˆ ë°”ë€ŒëŠ”ì§€ í™•ì¸í•œë‹¤.
3. **ê±°ë˜ì²˜ ì •ë³´ ìˆ˜ì • ì ìš©**: ì£¼ì†ŒÂ·ë‹´ë‹¹ì ì´ë¦„ ìˆ˜ì • í›„ ì¬ìƒì„±í–ˆì„ ë•Œ PDF ë‚´ ì •ë³´ê°€ ì—…ë°ì´íŠ¸ë˜ëŠ”ì§€ ë³¸ë‹¤.
4. **ë‹¤ì¤‘ ì–¸ì–´ ì¶œë ¥**: ë‹¤êµ­ì–´ ì˜µì…˜(ì˜ˆ: ì˜ë¬¸) ì„ íƒ ì‹œ ë ˆì´ì•„ì›ƒê³¼ ë¬¸êµ¬ê°€ ì–¸ì–´ë³„ë¡œ ë³€ê²½ë˜ëŠ”ì§€ í™•ì¸í•œë‹¤.
5. **PDF ë‹¤ìš´ë¡œë“œ**: ì¶œë ¥ëœ PDF ì €ì¥ ì‹œ íŒŒì¼ëª…ì´ `Invoice_{ì •ì‚°ID}.pdf`ë¡œ ë‚´ë ¤ë°›ì•„ì§€ê³  ë¸Œë¼ìš°ì € ê²½ê³  ì—†ì´ ì™„ë£Œë˜ëŠ”ì§€ ë³¸ë‹¤.

## 7) ì›”ë§ˆê° (Page_MonthlyClosing)
1. **ë§ˆê° ëŒ€ìƒ ì¡°íšŒ**: íŠ¹ì • ì›”ì„ ì„ íƒí•´ ì¡°íšŒí•˜ë©´ í•´ë‹¹ ì›”ì˜ ë§¤ì¶œ/ë§¤ì… ì§‘ê³„ê°€ ìš”ì•½ ì¹´ë“œì™€ í‘œì— í‘œì‹œë˜ëŠ”ì§€ í™•ì¸í•œë‹¤.
2. **ë§ˆê° ì‹¤í–‰**: `ë§ˆê° ì‹¤í–‰` ë²„íŠ¼ í´ë¦­ ì‹œ ì„±ê³µ ì•Œë¦¼ì´ ëœ¨ê³  ìƒíƒœ ë°°ì§€ê°€ `ë§ˆê°ì™„ë£Œ`ë¡œ ë°”ë€ŒëŠ”ì§€ ë³¸ë‹¤.
3. **ë§ˆê° ì·¨ì†Œ/ì¬ì˜¤í”ˆ**: ì´ë¯¸ ë§ˆê°ëœ ì›”ì—ì„œ `ë§ˆê° ì·¨ì†Œ`ë¥¼ ì‹¤í–‰í•´ ìƒíƒœê°€ `ì§„í–‰ì¤‘`ìœ¼ë¡œ ëŒì•„ì˜¤ëŠ”ì§€ í™•ì¸í•œë‹¤.
4. **ë§ˆê° ìƒì„¸**: ë§ˆê° í•­ëª©ì˜ ìƒì„¸ ë²„íŠ¼ìœ¼ë¡œ í¬í•¨ëœ ì •ì‚°/ì²­êµ¬ì„œ ëª©ë¡ì´ ì •í™•íˆ í‘œì‹œë˜ëŠ”ì§€ ê²€ì¦í•œë‹¤.
5. **ë§ˆê° ë¡œê·¸ í™•ì¸**: ìˆ˜í–‰ìÂ·ì‹œê°„Â·ë©”ëª¨ ë¡œê·¸ê°€ ë‚¨ê³  ì¬ì¡°íšŒ ì‹œì—ë„ ë™ì¼í•˜ê²Œ ìœ ì§€ë˜ëŠ”ì§€ í™•ì¸í•œë‹¤.

---
- ìœ„ ì‹œë‚˜ë¦¬ì˜¤ëŠ” í˜„ì¬ UI íë¦„(ê²€ìƒ‰ â†’ ì¡°íšŒ ê²°ê³¼ â†’ ìƒì„¸ ëª¨ë‹¬ â†’ ìƒíƒœ ë³€ê²½/ì¶œë ¥)ì„ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±í–ˆìœ¼ë©°, ì‹ ê·œ ê¸°ëŠ¥ ì¶”ê°€ ì‹œ í™•ì¥í•´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì‹¤ì œ í…ŒìŠ¤íŠ¸ ì‹œì—ëŠ” ê° í˜ì´ì§€ì˜ ì´ˆê¸°í™” í•¨ìˆ˜(`init*Page`)ê°€ ì •ìƒ ì‹¤í–‰ë˜ëŠ”ì§€, ë¡œë”© ì˜¤ë²„ë ˆì´/ì•Œë¦¼ì´ ì˜ë„ëŒ€ë¡œ í‘œì‹œë˜ëŠ”ì§€ í•¨ê»˜ ì ê²€í•˜ì„¸ìš”.